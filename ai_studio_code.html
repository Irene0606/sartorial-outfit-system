<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SARTORIAL | æ™ºæ…§è¡£æ«¥</title>
    <style>
        /* 
         * ğŸ¨ A. UI è¨­è¨ˆç³»çµ±ï¼šæ¥µç°¡ã€é«˜ç´šã€è‡ªç„¶è³ªæ„Ÿ 
         */
        :root {
            --bg-color: #F9F8F6;       /* æº«æš–ç±³ç™½èƒŒæ™¯ */
            --card-bg: #FFFFFF;        /* ç´”ç™½å¡ç‰‡ */
            --text-main: #4A4A4A;      /* æ·±ç°ä¸»è‰² */
            --text-sub: #908E8C;       /* æ·ºç°å‰¯è‰² */
            --accent: #8E8070;         /* è«è˜­è¿ªæ£•/æ·¡æœ¨é ­è‰² */
            --accent-light: #E8E4E1;   /* æ·ºå¼·èª¿è‰² */
            --border: #ECEBE9;         /* æ¥µæ·¡é‚Šæ¡† */
            --shadow: 0 10px 30px rgba(120, 110, 100, 0.06); /* æŸ”å’Œé«˜ç´šé™°å½± */
            --radius: 12px;
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            --font-stack: "PingFang TC", "Heiti TC", "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif;
        }

        * {
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-stack);
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            line-height: 1.7;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        h1, h2, h3, h4 {
            font-weight: 400;
            margin: 0 0 15px 0;
            letter-spacing: 0.1em;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeIn 1s ease;
        }

        header h1 {
            font-size: 2.2rem;
            color: #2C2C2C;
            letter-spacing: 0.2em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 0.9rem;
            color: var(--text-sub);
            font-style: italic;
        }

        /* å¡ç‰‡ç³»çµ± */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.8);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(120, 110, 100, 0.1);
        }

        /* è¡¨å–®å…ƒç´  */
        label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-sub);
            margin-bottom: 8px;
            font-weight: 500;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            background: #FAFAFA;
            color: var(--text-main);
            font-size: 1rem;
            transition: var(--transition);
            appearance: none;
            font-family: var(--font-stack);
        }

        input:focus, select:focus {
            background: #FFF;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(142, 128, 112, 0.1);
        }

        /* æŒ‰éˆ•ç³»çµ± */
        .btn {
            border: none;
            cursor: pointer;
            border-radius: 30px;
            padding: 12px 30px;
            font-size: 0.95rem;
            transition: var(--transition);
            letter-spacing: 0.1em;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-stack);
        }

        .btn-primary {
            background-color: var(--text-main);
            color: #FFF;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .btn-primary:hover {
            background-color: #222;
            transform: scale(1.02);
        }

        .btn-secondary {
            background-color: transparent;
            border: 1px solid #DDD;
            color: var(--text-sub);
        }
        .btn-secondary:hover {
            border-color: var(--text-main);
            color: var(--text-main);
        }

        .btn-text {
            background: none;
            color: var(--accent);
            padding: 5px 10px;
            font-size: 0.85rem;
            text-decoration: underline;
            text-underline-offset: 4px;
            border: none;
            cursor: pointer;
            font-family: var(--font-stack);
        }
        .btn-text:hover { color: var(--text-main); }

        /* Step æµç¨‹æ¨£å¼ */
        .step-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .step-container.active { display: block; }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 1px;
            background: #EEE;
            z-index: 0;
        }
        .step-dot {
            width: 30px;
            height: 30px;
            background: #FFF;
            border: 1px solid #DDD;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #CCC;
            z-index: 1;
            transition: var(--transition);
        }
        .step-dot.active {
            border-color: var(--accent);
            color: var(--accent);
            font-weight: bold;
            background: var(--bg-color);
        }

        /* å¤šé¸ Tag æ¨£å¼ */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .check-tag input { display: none; }
        .check-tag span {
            display: inline-block;
            padding: 8px 16px;
            background: #F5F5F5;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #888;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
        }
        .check-tag input:checked + span {
            background: var(--accent);
            color: #FFF;
            box-shadow: 0 4px 10px rgba(142, 128, 112, 0.3);
        }

        /* è¡£æ«¥ Grid */
        .closet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
        }
        .item-card {
            background: #FFF;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #F0F0F0;
            transition: var(--transition);
            position: relative;
        }
        .item-card:hover {
            transform: scale(1.03);
            box-shadow: var(--shadow);
            z-index: 2;
        }
        .item-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: #F9F9F9;
        }
        .item-info {
            padding: 12px;
        }
        .item-info h4 {
            font-size: 0.95rem;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #333;
        }
        .item-tags {
            font-size: 0.75rem;
            color: #AAA;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        .tag-pill {
            background: #F7F7F7;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .usage-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            backdrop-filter: blur(4px);
        }

        /* æ¨è–¦çµæœå€ */
        .result-section {
            display: none;
            animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        
        .weather-banner {
            background: linear-gradient(135deg, #FDFBF9 0%, #F2EFED 100%);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #EEE;
        }
        .weather-icon { font-size: 2.5rem; margin-right: 15px; }
        .weather-text h3 { margin-bottom: 5px; color: var(--accent); }
        .weather-text p { font-size: 0.9rem; color: #666; margin: 0; }

        .outfit-display {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }
        .outfit-piece {
            width: 180px;
            text-align: center;
        }
        .outfit-piece img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .philosophy-box {
            background: #FFFEFC;
            border-left: 3px solid var(--accent);
            padding: 20px 30px;
            font-style: italic;
            color: #555;
            margin: 30px 0;
            position: relative;
        }
        .philosophy-box::before {
            content: '"';
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 3rem;
            color: #EEE;
            font-family: serif;
            z-index: 0;
        }

        .vibe-tags {
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            color: var(--accent);
            text-transform: uppercase;
        }

        .extra-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
            font-size: 0.85rem;
            color: #777;
        }
        .info-block {
            background: #FAFAFA;
            padding: 15px;
            border-radius: 8px;
        }

        /* å‹•ç•« Keyframes */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* Toggle Switch */
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }
        .switch-bg {
            width: 40px;
            height: 20px;
            background: #DDD;
            border-radius: 20px;
            position: relative;
            transition: 0.3s;
        }
        .switch-bg::after {
            content: '';
            position: absolute;
            left: 2px; top: 2px;
            width: 16px; height: 16px;
            background: #FFF;
            border-radius: 50%;
            transition: 0.3s;
        }
        input:checked + .switch-bg { background: var(--accent); }
        input:checked + .switch-bg::after { left: 22px; }

        /* Feedback Buttons */
        .feedback-btns {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #EEE;
        }
        .fb-btn {
            background: #FFF;
            border: 1px solid #E0E0E0;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #666;
            cursor: pointer;
            transition: 0.2s;
            font-family: var(--font-stack);
        }
        .fb-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SARTORIAL</h1>
        <p>ç‚ºæ‚¨æ‰“é€ çš„æ™ºæ…§ç©¿æ­ç³»çµ±</p>
    </header>

    <!-- ğŸ§© B. Step-by-Step æ–°å¢è¡£æœ -->
    <section class="card" id="addSection">
        <h3 style="text-align:center; margin-bottom:30px;">æ–°å¢å–®å“åˆ°è¡£æ«¥</h3>
        
        <div class="step-indicator">
            <div class="step-dot active" id="dot1">1</div>
            <div class="step-dot" id="dot2">2</div>
            <div class="step-dot" id="dot3">3</div>
            <div class="step-dot" id="dot4">4</div>
        </div>

        <form id="addItemForm">
            <!-- Step 1: Basic -->
            <div class="step-container active" id="step1">
                <label>è¡£æœåç¨±</label>
                <input type="text" id="itemName" placeholder="ä¾‹å¦‚ï¼šç¾Šæ¯›é‡ç¹”è¡«">
                
                <label style="margin-top:15px">é¡åˆ¥</label>
                <select id="itemType" onchange="toggleSpecialFields()">
                    <option value="top">Top (ä¸Šè¡£)</option>
                    <option value="pants">Pants (ä¸‹èº«)</option>
                    <option value="outer">Outerwear (å¤–å¥—)</option>
                    <option value="accessory">Accessory (é£¾å“)</option>
                </select>

                <label style="margin-top:15px">ä¸Šå‚³åœ–ç‰‡</label>
                <input type="file" id="itemImg" accept="image/*">
                
                <div style="text-align:right; margin-top:20px;">
                    <button type="button" class="btn btn-primary" onclick="changeStep(1)">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- Step 2: Weather & Thickness -->
            <div class="step-container" id="step2">
                <label>é©åˆå¤©æ°£</label>
                <select id="itemWeather">
                    <option value="cold">å¯’å†· (< 15Â°C)</option>
                    <option value="cool">æ¶¼çˆ½ (15-22Â°C)</option>
                    <option value="warm">æº«æš– (22-28Â°C)</option>
                    <option value="hot">ç‚ç†± (> 28Â°C)</option>
                </select>

                <label style="margin-top:15px">åšåº¦</label>
                <select id="itemThickness">
                    <option value="thin">è–„ / é€æ°£</option>
                    <option value="medium">é©ä¸­</option>
                    <option value="thick">åš / ä¿æš–</option>
                </select>

                <div style="display:flex; justify-content:space-between; margin-top:20px;">
                    <button type="button" class="btn btn-secondary" onclick="changeStep(-1)">ä¸Šä¸€æ­¥</button>
                    <button type="button" class="btn btn-primary" onclick="changeStep(1)">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- Step 3: Style & Tags -->
            <div class="step-container" id="step3">
                <label>æè³ª (å¯å¤šé¸)</label>
                <div class="checkbox-group">
                    <label class="check-tag"><input type="checkbox" name="material" value="Cotton"><span>æ£‰</span></label>
                    <label class="check-tag"><input type="checkbox" name="material" value="Linen"><span>éº»</span></label>
                    <label class="check-tag"><input type="checkbox" name="material" value="Wool"><span>ç¾Šæ¯›</span></label>
                    <label class="check-tag"><input type="checkbox" name="material" value="Silk"><span>çµ²</span></label>
                    <label class="check-tag"><input type="checkbox" name="material" value="Polyester"><span>èšé…¯çº–ç¶­</span></label>
                    <label class="check-tag"><input type="checkbox" name="material" value="Denim"><span>ä¸¹å¯§</span></label>
                    <label class="check-tag"><input type="checkbox" name="material" value="Leather"><span>çš®é©</span></label>
                </div>

                <label style="margin-top:15px">é¢¨æ ¼</label>
                <select id="itemStyle">
                    <option value="minimal">æ¥µç°¡</option>
                    <option value="sweet">ç”œç¾</option>
                    <option value="street">è¡—é ­</option>
                    <option value="formal">æ­£å¼</option>
                    <option value="sporty">é‹å‹•</option>
                    <option value="japanese">æ—¥ç³»</option>
                    <option value="korean">éŸ“ç³»</option>
                </select>

                <label style="margin-top:15px">å ´æ™¯ (å¯å¤šé¸)</label>
                <div class="checkbox-group">
                    <label class="check-tag"><input type="checkbox" name="scene" value="Work"><span>ä¸Šç­</span></label>
                    <label class="check-tag"><input type="checkbox" name="scene" value="Casual"><span>ä¼‘é–’</span></label>
                    <label class="check-tag"><input type="checkbox" name="scene" value="Date"><span>ç´„æœƒ</span></label>
                    <label class="check-tag"><input type="checkbox" name="scene" value="Sport"><span>é‹å‹•</span></label>
                    <label class="check-tag"><input type="checkbox" name="scene" value="Travel"><span>æ—…éŠ</span></label>
                </div>

                <label style="margin-top:15px">é¡è‰²</label>
                <select id="itemColor">
                    <option value="White">ç™½ / ç±³è‰²</option>
                    <option value="Black">é»‘</option>
                    <option value="Grey">ç°</option>
                    <option value="Brown">æ£• / å¤§åœ°è‰²</option>
                    <option value="Color">å½©è‰²</option>
                </select>

                <label style="margin-top:15px">å¯æ›¿ä»£å“ç¾¤çµ„ (é¸å¡«)</label>
                <input type="text" id="itemAltGroup" placeholder="ä¾‹å¦‚ï¼šbasic_white_tee">

                <div style="display:flex; justify-content:space-between; margin-top:20px;">
                    <button type="button" class="btn btn-secondary" onclick="changeStep(-1)">ä¸Šä¸€æ­¥</button>
                    <button type="button" class="btn btn-primary" onclick="changeStep(1)">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- Step 4: Care & Special -->
            <div class="step-container" id="step4">
                <label>æ´—æ»Œæ–¹å¼</label>
                <select id="itemWash">
                    <option value="Machine">æ©Ÿæ´—</option>
                    <option value="Hand">æ‰‹æ´—</option>
                    <option value="DryClean">ä¹¾æ´—</option>
                    <option value="Wipe">åƒ…æ“¦æ‹­</option>
                </select>

                <!-- Outer Specific -->
                <div id="outerFields" style="display:none; margin-top:15px; padding:15px; background:#F5F5F5; border-radius:8px;">
                    <label>ä¿æš–åº¦</label>
                    <select id="outerWarmth"><option value="Low">ä½</option><option value="Med">ä¸­</option><option value="High">é«˜</option></select>
                    <label style="margin-top:10px">é˜²é¢¨æ€§</label>
                    <select id="outerWind"><option value="Low">ä½</option><option value="Med">ä¸­</option><option value="High">é«˜</option></select>
                    <label class="toggle-switch" style="margin-top:10px">
                        <input type="checkbox" id="outerWater">
                        <span class="switch-bg"></span> æ˜¯å¦é˜²æ°´ï¼Ÿ
                    </label>
                </div>

                <!-- Accessory Specific -->
                <div id="accFields" style="display:none; margin-top:15px; padding:15px; background:#F5F5F5; border-radius:8px;">
                    <label>ç¨®é¡</label>
                    <select id="accType"><option value="Necklace">é …éŠ</option><option value="Hat">å¸½å­</option><option value="Ring">æˆ’æŒ‡</option><option value="Scarf">åœå·¾</option><option value="Bag">åŒ…åŒ…</option></select>
                    <label style="margin-top:10px">å­˜åœ¨æ„Ÿ</label>
                    <select id="accPresence"><option value="Low">ä½ (é»ç¶´)</option><option value="Med">ä¸­</option><option value="High">é«˜ (äº®é»)</option></select>
                </div>

                <div style="display:flex; justify-content:space-between; margin-top:20px;">
                    <button type="button" class="btn btn-secondary" onclick="changeStep(-1)">ä¸Šä¸€æ­¥</button>
                    <button type="button" class="btn btn-primary" onclick="addItem()">åŠ å…¥è¡£æ«¥</button>
                </div>
            </div>
        </form>
    </section>

    <!-- ğŸ§© C. è¡£æ«¥å±•ç¤º -->
    <section class="card">
        <h3 style="margin-bottom:20px;">æˆ‘çš„è¡£æ«¥</h3>
        <div class="closet-grid" id="closetGrid">
            <!-- Rendered by JS -->
            <p style="grid-column:1/-1; text-align:center; color:#AAA;">è¼‰å…¥è¡£æ«¥ä¸­...</p>
        </div>
    </section>

    <!-- ğŸ§© D. æ¨è–¦æ¢ä»¶è¼¸å…¥ -->
    <section class="card">
        <h3>ä»Šæ—¥ç©¿æ­è¨­å®š</h3>
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px;">
            <div>
                <label>ç¾åœ¨æ°£æº« (Â°C)</label>
                <input type="number" id="todayTemp" value="22">
            </div>
            <div>
                <label>ä»Šæ—¥å ´æ™¯</label>
                <select id="todayScene">
                    <option value="Work">ä¸Šç­</option>
                    <option value="Casual">ä¼‘é–’</option>
                    <option value="Date">ç´„æœƒ</option>
                    <option value="Sport">é‹å‹•</option>
                </select>
            </div>
            <div>
                <label>ä»Šæ—¥å¿ƒæƒ…</label>
                <select id="todayMood">
                    <option value="Relaxed">æ”¾é¬†</option>
                    <option value="Professional">å°ˆæ¥­å¹¹ç·´</option>
                    <option value="Cute">å¯æ„›</option>
                    <option value="Cool">ç‡æ€§</option>
                    <option value="Soft">æº«æŸ”</option>
                </select>
            </div>
        </div>

        <div style="margin-top:20px; display:flex; gap:30px; flex-wrap:wrap;">
            <label class="toggle-switch">
                <input type="checkbox" id="todayRain">
                <span class="switch-bg"></span> æ˜¯å¦ä¸‹é›¨ï¼Ÿ
            </label>
            <label class="toggle-switch">
                <input type="checkbox" id="needOuter" checked>
                <span class="switch-bg"></span> éœ€è¦å¤–å¥—ï¼Ÿ
            </label>
            <label class="toggle-switch">
                <input type="checkbox" id="needAcc" checked>
                <span class="switch-bg"></span> éœ€è¦é£¾å“ï¼Ÿ
            </label>
        </div>

        <div style="margin-top:20px;">
            <label>æƒ³å˜—è©¦çš„é¢¨æ ¼ (å¯å¤šé¸)</label>
            <div class="checkbox-group">
                <label class="check-tag"><input type="checkbox" name="todayStyle" value="minimal" checked><span>æ¥µç°¡</span></label>
                <label class="check-tag"><input type="checkbox" name="todayStyle" value="street"><span>è¡—é ­</span></label>
                <label class="check-tag"><input type="checkbox" name="todayStyle" value="formal"><span>æ­£å¼</span></label>
                <label class="check-tag"><input type="checkbox" name="todayStyle" value="sweet"><span>ç”œç¾</span></label>
            </div>
        </div>

        <div style="text-align:center; margin-top:30px;">
            <button class="btn btn-primary" onclick="generateOutfits()">ç”¢ç”Ÿä»Šæ—¥ç©¿æ­</button>
        </div>
    </section>

    <!-- ğŸ§© F. æ¨è–¦çµæœ -->
    <section class="card result-section" id="resultSection">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <button class="btn btn-secondary" onclick="prevOutfit()">â® ä¸Šä¸€å¥—</button>
            <h4 style="margin:0;">ç©¿æ­ææ¡ˆ <span id="outfitIdx">1</span> / 3</h4>
            <button class="btn btn-secondary" onclick="nextOutfit()">ä¸‹ä¸€å¥— â¯</button>
        </div>

        <!-- E. å¤©æ°£è§£è®€ -->
        <div class="weather-banner" id="weatherBanner">
            <!-- Rendered by JS -->
        </div>

        <!-- M. æ°›åœæ¨™ç±¤ -->
        <div class="vibe-tags" id="vibeTags"></div>

        <!-- G. ç©¿æ­å±•ç¤º -->
        <div class="outfit-display" id="outfitDisplay">
            <!-- Rendered by JS -->
        </div>

        <!-- G. ç©¿æ­ç†å¿µ -->
        <div class="philosophy-box" id="philosophyText">
            <!-- Rendered by JS -->
        </div>

        <!-- K. & L. & J. é¡å¤–è³‡è¨Š -->
        <div class="extra-info">
            <div class="info-block" id="fragranceBox">
                <strong>ğŸŒ¿ é¦™æ°›æ¨è–¦</strong><br>
                <span>-</span>
            </div>
            <div class="info-block" id="motivationBox">
                <strong>âœ¨ çµ¦ä½ çš„ä¸€å¥è©±</strong><br>
                <span>-</span>
            </div>
        </div>

        <!-- N. ä½¿ç”¨è€…å›é¥‹ -->
        <div class="feedback-btns">
            <button class="fb-btn" onclick="handleFeedback('cold')">â„ï¸ å¤ªå†·</button>
            <button class="fb-btn" onclick="handleFeedback('good')">â¤ï¸ å‰›å¥½</button>
            <button class="fb-btn" onclick="handleFeedback('hot')">ğŸ”¥ å¤ªç†±</button>
            <button class="fb-btn" onclick="handleFeedback('dislike')">ğŸ’” ä¸å–œæ­¡</button>
        </div>
    </section>

</div>

<script>
    /* 
     * ğŸ§© Data & State Management
     */
    
    // ä¸­æ–‡åŒ–å°ç…§è¡¨ (Internal Value -> Chinese Display)
    const labelMap = {
        'top': 'ä¸Šè¡£', 'pants': 'ä¸‹èº«', 'outer': 'å¤–å¥—', 'accessory': 'é£¾å“',
        'cold': 'å¯’å†·', 'cool': 'æ¶¼çˆ½', 'warm': 'æº«æš–', 'hot': 'ç‚ç†±',
        'minimal': 'æ¥µç°¡', 'sweet': 'ç”œç¾', 'street': 'è¡—é ­', 'formal': 'æ­£å¼', 'sporty': 'é‹å‹•', 'japanese': 'æ—¥ç³»', 'korean': 'éŸ“ç³»',
        'Cotton': 'æ£‰', 'Linen': 'éº»', 'Wool': 'ç¾Šæ¯›', 'Silk': 'çµ²', 'Polyester': 'èšé…¯', 'Denim': 'ä¸¹å¯§', 'Leather': 'çš®é©'
    };

    let closet = [
        // Demo Data
        { id: 1, name: "ç¾Šæ¯›é‡ç¹”è¡«", type: "top", weather: "cold", thickness: "medium", material: ["Wool"], style: "minimal", scene: ["Work", "Date"], color: "Brown", wash: "DryClean", img: "https://images.unsplash.com/photo-1576566588028-4147f3842f27?w=400", usageCount: 5, altGroup: "sweater_basic" },
        { id: 2, name: "ç™½è‰²äºéº»è¥¯è¡«", type: "top", weather: "hot", thickness: "thin", material: ["Linen"], style: "minimal", scene: ["Casual", "Travel"], color: "White", wash: "Machine", img: "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=400", usageCount: 2, altGroup: "white_shirt" },
        { id: 3, name: "é»‘è‰²å¯¬è¥¿è£è¤²", type: "pants", weather: "cool", thickness: "medium", material: ["Polyester"], style: "formal", scene: ["Work"], color: "Black", wash: "Machine", img: "https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=400", usageCount: 8, altGroup: "black_pants" },
        { id: 4, name: "ç›´ç­’ä¸¹å¯§è¤²", type: "pants", weather: "cool", thickness: "medium", material: ["Denim"], style: "street", scene: ["Casual"], color: "Blue", wash: "Machine", img: "https://images.unsplash.com/photo-1542272454374-d41e9529cf5d?w=400", usageCount: 12, altGroup: "jeans" },
        { id: 5, name: "ç±³è‰²ç¾Šæ¯›å¤§è¡£", type: "outer", weather: "cold", thickness: "thick", material: ["Wool"], style: "minimal", scene: ["Work", "Date"], color: "Beige", wash: "DryClean", outerWarmth: "High", outerWind: "Med", img: "https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=400", usageCount: 3, altGroup: "coat" },
        { id: 6, name: "ç´”éŠ€æˆ’æŒ‡", type: "accessory", style: "minimal", scene: ["Date", "Work"], accPresence: "Low", img: "https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400", usageCount: 1, altGroup: "ring" },
        { id: 7, name: "åŸºæœ¬æ¬¾ç™½T", type: "top", weather: "warm", thickness: "medium", material: ["Cotton"], style: "minimal", scene: ["Casual"], color: "White", wash: "Machine", img: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400", usageCount: 15, altGroup: "white_tee" }
    ];

    let userPreference = {
        tempBias: 0,      // + å–œæ­¡ç©¿æ¶¼ä¸€é», - å–œæ­¡ç©¿æš–ä¸€é»
        styleBias: {},    // e.g. { minimal: 5, street: 2 }
        dislikeItems: []  // IDs
    };

    let generatedOutfits = [];
    let currentOutfitIdx = 0;
    let currentStep = 1;

    /* 
     * ğŸ§© B. Step Form Logic
     */
    function changeStep(dir) {
        // Step 1 é©—è­‰
        if(currentStep === 1 && dir === 1) {
            if(!document.getElementById('itemName').value) { alert("è«‹è¼¸å…¥è¡£æœåç¨±"); return; }
        }
        
        document.getElementById(`step${currentStep}`).classList.remove('active');
        document.getElementById(`dot${currentStep}`).classList.remove('active');
        
        currentStep += dir;
        
        document.getElementById(`step${currentStep}`).classList.add('active');
        document.getElementById(`dot${currentStep}`).classList.add('active');
    }

    function toggleSpecialFields() {
        const type = document.getElementById('itemType').value;
        document.getElementById('outerFields').style.display = type === 'outer' ? 'block' : 'none';
        document.getElementById('accFields').style.display = type === 'accessory' ? 'block' : 'none';
    }

    function addItem() {
        const name = document.getElementById('itemName').value;
        const type = document.getElementById('itemType').value;
        const imgInput = document.getElementById('itemImg');
        const imgUrl = imgInput.files[0] ? URL.createObjectURL(imgInput.files[0]) : "https://via.placeholder.com/400x500/eee/aaa?text=No+Image";

        // Collect Multi-selects
        const getChecked = (name) => Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(el => el.value);

        const newItem = {
            id: Date.now(),
            name: name,
            type: type,
            weather: document.getElementById('itemWeather').value,
            thickness: document.getElementById('itemThickness').value,
            material: getChecked('material'),
            style: document.getElementById('itemStyle').value,
            scene: getChecked('scene'),
            color: document.getElementById('itemColor').value,
            altGroup: document.getElementById('itemAltGroup').value,
            wash: document.getElementById('itemWash').value,
            img: imgUrl,
            usageCount: 0,
            // Conditionals
            outerWarmth: type === 'outer' ? document.getElementById('outerWarmth').value : null,
            outerWind: type === 'outer' ? document.getElementById('outerWind').value : null,
            outerWater: type === 'outer' ? document.getElementById('outerWater').checked : false,
            accType: type === 'accessory' ? document.getElementById('accType').value : null,
            accPresence: type === 'accessory' ? document.getElementById('accPresence').value : null
        };

        closet.push(newItem);
        renderCloset();
        alert("æˆåŠŸåŠ å…¥è¡£æ«¥ï¼");
        // Reset
        document.getElementById('addItemForm').reset();
        currentStep = 4; changeStep(-3); // å›åˆ° step 1
    }

    /* 
     * ğŸ§© C. Render Closet
     */
    function renderCloset() {
        const grid = document.getElementById('closetGrid');
        grid.innerHTML = closet.map(item => `
            <div class="item-card">
                <div class="usage-badge">å·²ç©¿ ${item.usageCount} æ¬¡</div>
                <img src="${item.img}" alt="${item.name}">
                <div class="item-info">
                    <h4>${item.name}</h4>
                    <div class="item-tags">
                        <span class="tag-pill">${labelMap[item.type] || item.type}</span>
                        <span class="tag-pill">${labelMap[item.weather] || item.weather}</span>
                        <span class="tag-pill">${labelMap[item.style] || item.style}</span>
                    </div>
                </div>
            </div>
        `).join('');
    }

    /* 
     * ğŸ§© D. & F. Recommendation Logic
     */
    function getTempTag(t) {
        let temp = parseFloat(t) + userPreference.tempBias; // Bias ä¿®æ­£
        if (temp < 15) return 'cold';
        if (temp < 22) return 'cool';
        if (temp < 28) return 'warm';
        return 'hot';
    }

    function generateOutfits() {
        const temp = document.getElementById('todayTemp').value;
        const rain = document.getElementById('todayRain').checked;
        const scene = document.getElementById('todayScene').value;
        const mood = document.getElementById('todayMood').value;
        const needOuter = document.getElementById('needOuter').checked;
        const needAcc = document.getElementById('needAcc').checked;
        const selectedStyles = Array.from(document.querySelectorAll('input[name="todayStyle"]:checked')).map(el => el.value);

        const tempTag = getTempTag(temp);
        
        // E. å¤©æ°£è§£è®€
        let weatherIcon = temp > 28 ? 'ğŸ”¥' : (temp < 15 ? 'ğŸŒ«' : 'â˜€');
        if(rain) weatherIcon = 'ğŸŒ§';
        
        let weatherText = "";
        if(rain) weatherText = "æ¿•åº¦åé«˜ï¼Œç©¿é€æ°£æè³ªæœƒæ›´èˆ’æœã€‚";
        else if(temp < 15) weatherText = "æ°£æº«è¼ƒä½ï¼Œå»ºè­°å¢åŠ å±¤æ¬¡åŠ å¼·ä¿æš–ã€‚";
        else if(temp > 28) weatherText = "é™½å…‰å¼·çƒˆï¼Œæ·ºè‰²ç³»è¡£ç‰©è¦–è¦ºä¸Šæ›´æ¸…çˆ½ã€‚";
        else weatherText = "èˆ’é©å®œäººçš„å¤©æ°£ï¼Œéå¸¸é©åˆå±•ç¾å±¤æ¬¡ç©¿æ­ã€‚";

        document.getElementById('weatherBanner').innerHTML = `
            <div class="weather-icon">${weatherIcon}</div>
            <div class="weather-text">
                <h3>${temp}Â°C / ${labelMap[tempTag]}</h3>
                <p>${weatherText}</p>
            </div>
        `;

        // é‚è¼¯æ ¸å¿ƒ
        generatedOutfits = [];
        
        // è¨ˆåˆ†å‡½å¼
        const scoreItem = (item) => {
            if(userPreference.dislikeItems.includes(item.id)) return -100;
            let score = 0;
            
            // å¤©æ°£åŒ¹é…
            if(item.weather === tempTag) score += 10;
            // æ¨¡ç³ŠåŒ¹é…
            if(tempTag === 'cool' && item.weather === 'cold') score += 5;
            if(tempTag === 'warm' && item.weather === 'hot') score += 5;

            // é¢¨æ ¼åŒ¹é…
            if(selectedStyles.includes(item.style)) score += 8;
            if(userPreference.styleBias[item.style]) score += userPreference.styleBias[item.style];

            // å ´æ™¯åŒ¹é…
            if(item.scene.includes(scene)) score += 5;

            // éš¨æ©Ÿå› å­
            score += Math.random() * 5; 

            return score;
        };

        const getBestItem = (type) => {
            const candidates = closet.filter(i => i.type === type).sort((a,b) => scoreItem(b) - scoreItem(a));
            // å¾å‰ 3 åéš¨æ©ŸæŒ‘é¸å¢åŠ è®ŠåŒ–
            return candidates.slice(0, 3)[Math.floor(Math.random() * Math.min(candidates.length, 3))];
        };

        // ç”¢ç”Ÿ 3 å¥—
        for(let i=0; i<3; i++) {
            let outfit = {};
            outfit.top = getBestItem('top');
            outfit.pants = getBestItem('pants');
            outfit.outer = needOuter ? getBestItem('outer') : null;
            outfit.acc = needAcc ? getBestItem('accessory') : null;
            outfit.meta = { temp, rain, scene, mood, tempTag };
            
            // å¿…é ˆè¦æœ‰ä¸Šä¸‹èº«æ‰ç®—æ•¸
            if(outfit.top && outfit.pants) generatedOutfits.push(outfit);
        }

        if(generatedOutfits.length === 0) {
            alert("è¡£ç‰©æ•¸é‡ä¸è¶³ä»¥ç”¢ç”Ÿæ¨è–¦ï¼Œè«‹å…ˆæ–°å¢æ›´å¤šå–®å“ã€‚");
            return;
        }

        currentOutfitIdx = 0;
        document.getElementById('resultSection').style.display = 'block';
        renderOutfit(0);
        
        // æ²å‹•åˆ°çµæœ
        document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
    }

    /* 
     * ğŸ§© G, H, I, J, K, L, M. æ¸²æŸ“èˆ‡ç´°ç¯€
     */
    function renderOutfit(idx) {
        const outfit = generatedOutfits[idx];
        document.getElementById('outfitIdx').textContent = idx + 1;
        
        // æ›´æ–°ä½¿ç”¨æ¬¡æ•¸ (æ­¤è™•ç‚ºæ¨¡æ“¬ï¼šå±•ç¤ºæ™‚å³å¢åŠ ï¼Œå¯¦éš›æ‡‰ç”¨å¯èƒ½åœ¨"ç¢ºèªé¸æ“‡"å¾Œå¢åŠ )
        [outfit.top, outfit.pants, outfit.outer, outfit.acc].forEach(item => {
            if(item) {
                const realItem = closet.find(i => i.id === item.id);
                if(realItem) realItem.usageCount++; 
            }
        });
        renderCloset(); // æ›´æ–°è¡£æ«¥ä¸Šçš„æ•¸å­—

        // é¡¯ç¤ºç©¿æ­
        const items = [outfit.top, outfit.pants, outfit.outer, outfit.acc].filter(x => x);
        const display = document.getElementById('outfitDisplay');
        display.innerHTML = items.map(item => `
            <div class="outfit-piece" style="animation: fadeIn 0.5s ease">
                <img src="${item.img}">
                <strong>${item.name}</strong><br>
                <span style="font-size:0.8rem; color:#888;">${(item.material[0] ? labelMap[item.material[0]] : "") || ""} Â· ${labelMap[item.style]}</span><br>
                <button class="btn-text" onclick="replaceItem(${item.id}, '${item.type}')">ğŸ”„ æ›´æ›ä¸€ä»¶</button>
            </div>
        `).join('');

        // M. æ°›åœæ¨™ç±¤
        const styles = items.map(i => labelMap[i.style] || i.style);
        const moodMap = { 'Relaxed': 'æ”¾é¬†', 'Professional': 'å°ˆæ¥­', 'Cute': 'å¯æ„›', 'Cool': 'ç‡æ€§', 'Soft': 'æº«æŸ”' };
        const uniqueStyles = [...new Set(styles)].join(' Ã— ');
        document.getElementById('vibeTags').textContent = `âœ¨ ä»Šæ—¥æ°›åœï¼š${uniqueStyles} Ã— ${moodMap[outfit.meta.mood]}`;

        // G. ç©¿æ­ç†å¿µ
        const philosophies = [
            `å› ç‚ºç¾åœ¨æ˜¯ ${outfit.meta.temp}Â°Cï¼Œå±¬æ–¼${labelMap[outfit.meta.tempTag]}å¤©æ°£ï¼Œæˆ‘é¸æ“‡äº†é€æ°£åº¦é©ä¸­çš„ä¸Šè¡£ä¾†å¹³è¡¡èˆ’é©æ„Ÿã€‚`,
            `é€™ä»¶${labelMap[outfit.pants.style]}é¢¨æ ¼çš„ä¸‹èº«ï¼Œèƒ½ä¿®é£¾èº«å½¢ç·šæ¢ï¼Œéå¸¸é©åˆä»Šå¤©çš„${outfit.meta.scene}å ´åˆã€‚`,
            `ç‚ºäº†å‘¼æ‡‰ä½ ä»Šå¤©ã€Œ${moodMap[outfit.meta.mood]}ã€çš„å¿ƒæƒ…ï¼Œæ•´é«”çš„æè³ªèˆ‡é…è‰²éƒ½ç¶“éæŒ‘é¸ï¼Œå¸Œæœ›èƒ½å¸¶çµ¦ä½ åŠ›é‡ã€‚`
        ];
        document.getElementById('philosophyText').innerHTML = philosophies.join("<br>");

        // K. é¦™æ°›æ¨è–¦
        const fragMap = {
            'minimal': 'æœ¨è³ªèª¿ / ç™½éºé¦™',
            'sweet': 'èŠ±æœé¦™ / æŸ‘æ©˜',
            'formal': 'çš®é© / è¾›é¦™èª¿',
            'street': 'æµ·æ´‹èª¿ / é¦¥å¥‡é¦™',
            'korean': 'çš‚æ„Ÿ / ç´”æ·¨äºéº»'
        };
        const mainStyle = outfit.top.style;
        document.getElementById('fragranceBox').innerHTML = `<strong>ğŸŒ¿ é¦™æ°›æ­é…å»ºè­°</strong><br>${fragMap[mainStyle] || 'ç¶“å…¸å¤é¾æ°´'}ï¼Œèƒ½å®Œç¾è¥¯æ‰˜ä½ çš„${labelMap[mainStyle]}æ°£è³ªã€‚`;

        // L. ä¿¡å¿ƒå°èª
        const quotes = [
            "ç„¡è«–ä»Šå¤©å¤šå¿™ï¼Œä½ éƒ½å€¼å¾—å¥½å¥½æ‰“æ‰®è‡ªå·±ã€‚",
            "é¢¨æ ¼æ˜¯ä¸ç”¨é–‹å£å°±èƒ½èªªå‡ºä½ æ˜¯èª°çš„æ–¹å¼ã€‚",
            "ä»Šå¤©çš„ç©¿æ­å……æ»¿èƒ½é‡ï¼Œé¡˜ä½ ä¹Ÿèƒ½è¢«ä¸–ç•Œæº«æŸ”ä»¥å¾…ã€‚",
            "è‡ªä¿¡å°±æ˜¯ä½ æœ€å¥½çš„é£¾å“ã€‚"
        ];
        document.getElementById('motivationBox').innerHTML = `<strong>âœ¨ çµ¦ä½ çš„ä¸€å¥è©±</strong><br>${quotes[Math.floor(Math.random()*quotes.length)]}`;
    }

    /* 
     * ğŸ§© H. æ›¿ä»£æ›´æ›é‚è¼¯
     */
    function replaceItem(currentId, type) {
        // å°‹æ‰¾æ›¿ä»£å“
        const currentItem = closet.find(i => i.id === currentId);
        const candidates = closet.filter(i => 
            i.type === type && 
            i.id !== currentId && 
            !userPreference.dislikeItems.includes(i.id)
        );

        // å„ªå…ˆç´š 1: åŒ altGroup
        let alt = candidates.find(i => i.altGroup && i.altGroup === currentItem.altGroup);
        
        // å„ªå…ˆç´š 2: åŒé¢¨æ ¼ & åŒè‰²ç³»
        if(!alt) alt = candidates.find(i => i.style === currentItem.style && i.color === currentItem.color);
        
        // å„ªå…ˆç´š 3: éš¨æ©Ÿå¯è¡Œé¸é …
        if(!alt && candidates.length > 0) alt = candidates[0];

        if(alt) {
            // æ›¿æ›
            const outfit = generatedOutfits[currentOutfitIdx];
            if(outfit.top && outfit.top.id === currentId) outfit.top = alt;
            if(outfit.pants && outfit.pants.id === currentId) outfit.pants = alt;
            if(outfit.outer && outfit.outer.id === currentId) outfit.outer = alt;
            if(outfit.acc && outfit.acc.id === currentId) outfit.acc = alt;
            
            renderOutfit(currentOutfitIdx);
        } else {
            alert("è¡£æ«¥ä¸­æ‰¾ä¸åˆ°é¡ä¼¼çš„æ›¿ä»£å“äº†ï¼");
        }
    }

    function prevOutfit() {
        if(currentOutfitIdx > 0) {
            currentOutfitIdx--;
            renderOutfit(currentOutfitIdx);
        }
    }
    function nextOutfit() {
        if(currentOutfitIdx < generatedOutfits.length - 1) {
            currentOutfitIdx++;
            renderOutfit(currentOutfitIdx);
        }
    }

    /* 
     * ğŸ§© N. å›é¥‹å­¸ç¿’ç³»çµ±
     */
    function handleFeedback(type) {
        const outfit = generatedOutfits[currentOutfitIdx];
        if(type === 'cold') {
            userPreference.tempBias -= 1;
            alert("æ”¶åˆ°ï¼ä¸‹æ¬¡æœƒç‚ºæ‚¨æ¨è–¦æ›´ä¿æš–çš„è¡£ç‰©ã€‚(æº«åº¦æ¬Šé‡ -1)");
        } else if(type === 'hot') {
            userPreference.tempBias += 1;
            alert("æ”¶åˆ°ï¼ä¸‹æ¬¡æœƒç‚ºæ‚¨æ¨è–¦æ›´æ¸…æ¶¼çš„è¡£ç‰©ã€‚(æº«åº¦æ¬Šé‡ +1)");
        } else if(type === 'dislike') {
            [outfit.top, outfit.pants, outfit.outer, outfit.acc].forEach(i => {
                if(i) userPreference.dislikeItems.push(i.id);
            });
            alert("å·²å°‡æ­¤æ­é…å–®å“åŠ å…¥ä¸å–œæ­¡æ¸…å–®ã€‚");
        } else if(type === 'good') {
            const s = outfit.top.style;
            userPreference.styleBias[s] = (userPreference.styleBias[s] || 0) + 1;
            alert("å¤ªæ£’äº†ï¼ç³»çµ±å·²å­¸ç¿’æ‚¨çš„é¢¨æ ¼åå¥½ã€‚");
        }
    }

    // åˆå§‹åŒ–æ¸²æŸ“
    renderCloset();

</script>

</body>
</html>
