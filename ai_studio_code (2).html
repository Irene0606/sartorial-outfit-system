<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SARTORIAL | æ™ºæ…§è¡£æ«¥</title>
    <style>
        /* 
         * ğŸ¨ UI è¨­è¨ˆç³»çµ±ï¼šæ¥µç°¡ã€é«˜ç´šã€è‡ªç„¶è³ªæ„Ÿ (é¡ç„¡å°é¢¨)
         */
        :root {
            --bg-color: #F9F8F6;       /* æº«æš–ç±³ç™½èƒŒæ™¯ */
            --card-bg: #FFFFFF;        /* ç´”ç™½å¡ç‰‡ */
            --text-main: #4A4A4A;      /* æ·±ç°ä¸»è‰² */
            --text-sub: #908E8C;       /* æ·ºç°å‰¯è‰² */
            --accent: #8E8070;         /* è«è˜­è¿ªæ£•/æ·¡æœ¨é ­è‰² */
            --accent-light: #E8E4E1;   /* æ·ºå¼·èª¿è‰² */
            --border: #ECEBE9;         /* æ¥µæ·¡é‚Šæ¡† */
            --shadow: 0 10px 30px rgba(120, 110, 100, 0.06); /* æŸ”å’Œé«˜ç´šé™°å½± */
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --font-stack: "PingFang TC", "Heiti TC", "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-stack);
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            line-height: 1.7;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        h1, h2, h3, h4 { font-weight: 400; margin: 0 0 15px 0; letter-spacing: 0.1em; }

        .container { max-width: 900px; margin: 0 auto; padding-bottom: 80px; }

        /* Header */
        header { text-align: center; margin-bottom: 60px; animation: fadeIn 1s ease; }
        header h1 { font-size: 2.2rem; color: #2C2C2C; letter-spacing: 0.2em; margin-bottom: 10px; }
        header p { font-size: 0.9rem; color: var(--text-sub); font-style: italic; }

        /* å¡ç‰‡ç³»çµ± */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.8);
            transition: var(--transition);
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(120, 110, 100, 0.1); }

        /* è¡¨å–®å…ƒç´  */
        label { display: block; font-size: 0.9rem; color: var(--text-sub); margin-bottom: 8px; font-weight: 500; }
        
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 12px 15px; border: 1px solid #E0E0E0; border-radius: 8px;
            background: #FAFAFA; color: var(--text-main); font-size: 1rem; transition: var(--transition);
            appearance: none; font-family: var(--font-stack);
        }
        input:focus, select:focus { background: #FFF; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(142, 128, 112, 0.1); }

        /* æŒ‰éˆ•ç³»çµ± */
        .btn {
            border: none; cursor: pointer; border-radius: 30px; padding: 12px 30px;
            font-size: 0.95rem; transition: var(--transition); letter-spacing: 0.1em;
            display: inline-flex; align-items: center; justify-content: center; font-family: var(--font-stack);
        }
        .btn-primary { background-color: var(--text-main); color: #FFF; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-primary:hover { background-color: #222; transform: scale(1.02); }
        .btn-secondary { background-color: transparent; border: 1px solid #DDD; color: var(--text-sub); }
        .btn-secondary:hover { border-color: var(--text-main); color: var(--text-main); }
        
        .btn-text {
            background: none; color: var(--accent); padding: 5px 10px; font-size: 0.85rem;
            text-decoration: underline; text-underline-offset: 4px; border: none; cursor: pointer;
            font-family: var(--font-stack);
        }
        .btn-text:hover { color: var(--text-main); }

        /* Step æµç¨‹æ¨£å¼ */
        .step-container { display: none; animation: fadeIn 0.5s ease; }
        .step-container.active { display: block; }

        .step-indicator { display: flex; justify-content: space-between; margin-bottom: 30px; position: relative; }
        .step-indicator::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: #EEE; z-index: 0; }
        .step-dot {
            width: 30px; height: 30px; background: #FFF; border: 1px solid #DDD; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: #CCC; z-index: 1; transition: var(--transition);
        }
        .step-dot.active { border-color: var(--accent); color: var(--accent); font-weight: bold; background: var(--bg-color); }

        /* å¤šé¸ Tag æ¨£å¼ */
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .check-tag input { display: none; }
        .check-tag span {
            display: inline-block; padding: 8px 16px; background: #F5F5F5; border-radius: 20px;
            font-size: 0.9rem; color: #888; cursor: pointer; transition: var(--transition); border: 1px solid transparent;
            user-select: none;
        }
        .check-tag input:checked + span { background: var(--accent); color: #FFF; box-shadow: 0 4px 10px rgba(142, 128, 112, 0.3); }

        /* è¡£æ«¥ Grid */
        .closet-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .item-card {
            background: #FFF; border-radius: 8px; overflow: hidden; border: 1px solid #F0F0F0;
            transition: var(--transition); position: relative;
        }
        .item-card:hover { transform: scale(1.03); box-shadow: var(--shadow); z-index: 2; }
        .item-card img { width: 100%; height: 180px; object-fit: cover; background: #F9F9F9; }
        .item-info { padding: 12px; }
        .item-info h4 { font-size: 0.95rem; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #333; }
        .item-tags { font-size: 0.75rem; color: #AAA; display: flex; flex-wrap: wrap; gap: 4px; }
        .tag-pill { background: #F7F7F7; padding: 2px 6px; border-radius: 4px; }
        .usage-badge {
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6);
            color: white; font-size: 0.75rem; padding: 2px 8px; border-radius: 10px; backdrop-filter: blur(4px);
        }

        /* æ¨è–¦çµæœå€ */
        .result-section { display: none; animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); }
        
        .weather-banner {
            background: linear-gradient(135deg, #FDFBF9 0%, #F2EFED 100%);
            padding: 20px; border-radius: var(--radius); margin-bottom: 30px;
            display: flex; align-items: center; justify-content: space-between; border: 1px solid #EEE;
        }
        .weather-icon { font-size: 2.5rem; margin-right: 15px; }
        .weather-text h3 { margin-bottom: 5px; color: var(--accent); }
        .weather-text p { font-size: 0.9rem; color: #666; margin: 0; }

        .outfit-display { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 30px; }
        .outfit-piece { width: 180px; text-align: center; }
        .outfit-piece img {
            width: 100%; height: 220px; object-fit: cover; border-radius: 8px;
            margin-bottom: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .philosophy-box {
            background: #FFFEFC; border-left: 3px solid var(--accent); padding: 20px 30px;
            font-style: italic; color: #555; margin: 30px 0; position: relative;
        }
        .philosophy-box::before {
            content: '"'; position: absolute; top: 10px; left: 10px; font-size: 3rem; color: #EEE; font-family: serif; z-index: 0;
        }

        .vibe-tags { text-align: center; margin-bottom: 20px; font-size: 0.9rem; letter-spacing: 0.1em; color: var(--accent); text-transform: uppercase; }

        .extra-info { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; font-size: 0.85rem; color: #777; }
        .info-block { background: #FAFAFA; padding: 20px; border-radius: 8px; height: 100%; display: flex; flex-direction: column; justify-content: center; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* Toggle Switch */
        .toggle-switch { display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px; font-size: 0.95rem; }
        .switch-bg { width: 40px; height: 20px; background: #DDD; border-radius: 20px; position: relative; transition: 0.3s; }
        .switch-bg::after { content: ''; position: absolute; left: 2px; top: 2px; width: 16px; height: 16px; background: #FFF; border-radius: 50%; transition: 0.3s; }
        input:checked + .switch-bg { background: var(--accent); }
        input:checked + .switch-bg::after { left: 22px; }

        .feedback-btns { display: flex; justify-content: center; gap: 15px; margin-top: 40px; padding-top: 30px; border-top: 1px solid #EEE; }
        .fb-btn { background: #FFF; border: 1px solid #E0E0E0; padding: 8px 20px; border-radius: 20px; font-size: 0.9rem; color: #666; cursor: pointer; transition: 0.2s; font-family: var(--font-stack); }
        .fb-btn:hover { border-color: var(--accent); color: var(--accent); }

        /* æ¢ä»¶é¡¯ç¤ºå€å¡Š */
        .conditional-block { display: none; }
        .conditional-block.active { display: block; animation: fadeIn 0.3s ease; }

        /* ç‰¹æ®Šè¼¸å…¥æ¡† */
        .other-input {
            margin-top: 10px; 
            display: none; 
            border-left: 3px solid var(--accent);
            padding-left: 10px;
        }
        .other-input.active { display: block; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SARTORIAL</h1>
        <p>ç‚ºæ‚¨æ‰“é€ çš„æ™ºæ…§ç©¿æ­ç³»çµ±</p>
    </header>

    <!-- ğŸ§© B. Step-by-Step æ–°å¢è¡£æœ -->
    <section class="card" id="addSection">
        <h3 style="text-align:center; margin-bottom:30px;">æ–°å¢å–®å“åˆ°è¡£æ«¥</h3>
        
        <div class="step-indicator">
            <div class="step-dot active" id="dot1">1</div>
            <div class="step-dot" id="dot2">2</div>
            <div class="step-dot" id="dot3">3</div>
            <div class="step-dot" id="dot4">4</div>
        </div>

        <form id="addItemForm">
            <!-- Step 1: Basic Information -->
            <div class="step-container active" id="step1">
                <label>å–®å“åç¨±</label>
                <input type="text" id="itemName" placeholder="ä¾‹å¦‚ï¼šç¾Šæ¯›é‡ç¹”è¡« / çç è€³ç’°">
                
                <label style="margin-top:15px">é¡åˆ¥</label>
                <select id="itemType" onchange="toggleFormLogic()">
                    <option value="top">Top (ä¸Šè¡£)</option>
                    <option value="bottom">Bottom (ä¸‹èº«)</option>
                    <option value="onepiece">One-Piece (é€£èº«è£™/è¤²)</option>
                    <option value="outer">Outerwear (å¤–å¥—)</option>
                    <option value="accessory">Accessory (é£¾å“)</option>
                </select>

                <!-- é£¾å“å­é¡åˆ¥ (å‹•æ…‹é¡¯ç¤º) -->
                <div id="accSubCategory" class="conditional-block">
                    <label style="margin-top:15px; color:var(--accent);">é£¾å“é¡å‹ (å¿…å¡«)</label>
                    <select id="accTypeSelect">
                        <option value="Necklace">é …éŠ</option>
                        <option value="Bracelet">æ‰‹éŠ</option>
                        <option value="Ring">æˆ’æŒ‡</option>
                        <option value="Earrings">è€³ç’°</option>
                        <option value="Sunglasses">å¢¨é¡</option>
                        <option value="Hat">å¸½å­</option>
                        <option value="Belt">è…°å¸¶</option>
                        <option value="Scarf">åœå·¾</option>
                        <option value="Gloves">æ‰‹å¥—</option>
                        <option value="HairAcc">é«®é£¾</option>
                        <option value="Brooch">èƒ¸é‡</option>
                        <option value="Anklet">è…³éŠ</option>
                        <option value="Other">å…¶ä»–</option>
                    </select>
                </div>

                <label style="margin-top:15px">ä¸Šå‚³åœ–ç‰‡</label>
                <input type="file" id="itemImg" accept="image/*">
                
                <div style="text-align:right; margin-top:20px;">
                    <button type="button" class="btn btn-primary" onclick="changeStep(1)">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- Step 2: Properties (Divergent) -->
            <div class="step-container" id="step2">
                <!-- è¡£æœå±¬æ€§ -->
                <div id="clothesProps" class="conditional-block active">
                    <label>é©åˆå¤©æ°£</label>
                    <select id="itemWeather">
                        <option value="cold">å¯’å†· (< 15Â°C)</option>
                        <option value="cool">æ¶¼çˆ½ (15-22Â°C)</option>
                        <option value="warm">æ‚¶ç†± (> 22Â°C)</option>
                    </select>
                    <label style="margin-top:15px">åšåº¦</label>
                    <select id="itemThickness">
                        <option value="thin">è–„</option>
                        <option value="medium">ä¸­</option>
                        <option value="thick">åš</option>
                    </select>
                </div>

                <!-- é£¾å“å±¬æ€§ -->
                <div id="accProps" class="conditional-block">
                    <label>ç©¿æˆ´ä½ç½® (å–®é¸)</label>
                    <select id="accBodyPart">
                        <option value="Head">é ­éƒ¨ (å¸½å­/é«®é£¾)</option>
                        <option value="Eyes">çœ¼éƒ¨ (å¢¨é¡)</option>
                        <option value="Neck">é ¸éƒ¨ (é …éŠ)</option>
                        <option value="Ears">è€³æœµ (è€³ç’°)</option>
                        <option value="Wrist">æ‰‹è…• (æ‰‹éŠ/éŒ¶)</option>
                        <option value="Finger">æ‰‹æŒ‡ (æˆ’æŒ‡)</option>
                        <option value="Waist">è…°éƒ¨ (è…°å¸¶)</option>
                        <option value="Shoulder">é ¸è‚© (åœå·¾)</option>
                        <option value="Hand">æ‰‹éƒ¨ (æ‰‹å¥—)</option>
                        <option value="Other">å…¶ä»–</option>
                    </select>
                </div>

                <div style="display:flex; justify-content:space-between; margin-top:20px;">
                    <button type="button" class="btn btn-secondary" onclick="changeStep(-1)">ä¸Šä¸€æ­¥</button>
                    <button type="button" class="btn btn-primary" onclick="changeStep(1)">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- Step 3: Details (Divergent) -->
            <div class="step-container" id="step3">
                <!-- å…±ç”¨: é¡è‰² -->
                <label>é¡è‰²</label>
                <select id="itemColor">
                    <option value="White">ç™½ / ç±³è‰²</option>
                    <option value="Black">é»‘</option>
                    <option value="Grey">ç°</option>
                    <option value="Brown">æ£• / å¤§åœ°è‰²</option>
                    <option value="Gold">é‡‘</option>
                    <option value="Silver">éŠ€</option>
                    <option value="Color">å½©è‰² / å…¶ä»–</option>
                </select>

                <!-- è¡£æœæè³ª -->
                <div id="clothesMaterials" class="conditional-block active" style="margin-top:15px;">
                    <label>æè³ª (è¡£æœ)</label>
                    <div class="checkbox-group">
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Cotton"><span>æ£‰</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Linen"><span>éº»</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Wool"><span>ç¾Šæ¯›</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Silk"><span>çµ²</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Polyester"><span>èšé…¯çº–ç¶­</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Denim"><span>ä¸¹å¯§</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Leather"><span>çš®é©</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Knitted"><span>é‡ç¹”</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Cashmere"><span>ç¾Šçµ¨</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Suede"><span>çµ¨é¢</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Shearling"><span>ç¾Šç¾”æ¯›</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Ribbed"><span>ç¾…ç´‹å¸ƒ</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Chiffon"><span>é›ªç´¡</span></label>
                        <label class="check-tag"><input type="checkbox" name="clothMat" value="Spandex"><span>å½ˆæ€§çº–ç¶­</span></label>
                    </div>
                </div>

                <!-- é£¾å“æè³ª -->
                <div id="accMaterials" class="conditional-block" style="margin-top:15px;">
                    <label>æè³ª (é£¾å“)</label>
                    <div class="checkbox-group">
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Gold"><span>é‡‘</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Silver"><span>éŠ€</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Copper"><span>éŠ…</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Platinum"><span>é‰‘é‡‘</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="RoseGold"><span>ç«ç‘°é‡‘</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Pearl"><span>çç </span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Gem"><span>æ°´æ™¶/å¯¶çŸ³</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Leather"><span>çš®é©</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Beads"><span>ç ä¸²</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Acrylic"><span>å£“å…‹åŠ›</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Wood"><span>æœ¨é ­</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Weave"><span>ç·¨ç¹”</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Fabric"><span>å¸ƒæ–™</span></label>
                        <label class="check-tag"><input type="checkbox" name="accMat" value="Natural"><span>è‡ªç„¶æè³ª</span></label>
                    </div>
                </div>

                <label style="margin-top:15px">é¢¨æ ¼</label>
                <!-- é¢¨æ ¼å€å¡Šï¼šå‹•æ…‹ç”Ÿæˆ -->
                <div class="checkbox-group" id="styleContainerAdd">
                    <!-- JS æ¸²æŸ“ -->
                </div>

                <label style="margin-top:15px">å ´æ™¯</label>
                <div class="checkbox-group">
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="Work"><span>ä¸Šç­</span></label>
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="Casual"><span>ä¼‘é–’</span></label>
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="Date"><span>ç´„æœƒ</span></label>
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="Sport"><span>é‹å‹•</span></label>
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="Travel"><span>æ—…éŠ</span></label>
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="School"><span>ä¸Šèª²</span></label>
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="Formal"><span>æ­£å¼å ´åˆ</span></label>
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="Home"><span>å®¶å±…</span></label>
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="NightOut"><span>å¤œé–“å¤–å‡º</span></label>
                    <label class="check-tag"><input type="checkbox" name="itemScene" value="Photoshoot"><span>æ‹ç…§</span></label>
                </div>

                <div style="display:flex; justify-content:space-between; margin-top:20px;">
                    <button type="button" class="btn btn-secondary" onclick="changeStep(-1)">ä¸Šä¸€æ­¥</button>
                    <button type="button" class="btn btn-primary" onclick="changeStep(1)">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- Step 4: Care & Finish -->
            <div class="step-container" id="step4">
                <!-- è¡£æœæ¸…æ½” -->
                <div id="clothesCare" class="conditional-block active">
                    <label>æ¸…æ½”æ–¹å¼ (å¯å¤šé¸)</label>
                    <div class="checkbox-group">
                        <label class="check-tag"><input type="checkbox" name="washMethod" value="æ©Ÿæ´—"><span>æ©Ÿæ´—</span></label>
                        <label class="check-tag"><input type="checkbox" name="washMethod" value="æ‰‹æ´—"><span>æ‰‹æ´—</span></label>
                        <label class="check-tag"><input type="checkbox" name="washMethod" value="ä¹¾æ´—"><span>ä¹¾æ´—</span></label>
                        <label class="check-tag"><input type="checkbox" name="washMethod" value="æ™¾ä¹¾"><span>æ™¾ä¹¾</span></label>
                        <label class="check-tag"><input type="checkbox" name="washMethod" value="é™°ä¹¾"><span>é™°ä¹¾</span></label>
                        <label class="check-tag"><input type="checkbox" name="washMethod" value="ä¸å¯çƒ˜ä¹¾"><span>ä¸å¯çƒ˜ä¹¾</span></label>
                        <label class="check-tag"><input type="checkbox" name="washMethod" value="ä½æº«ç†¨ç‡™"><span>ä½æº«ç†¨ç‡™</span></label>
                        <!-- å…¶ä»–é¸é …è§¸ç™¼è¼¸å…¥æ¡† -->
                        <label class="check-tag"><input type="checkbox" name="washMethod" value="å…¶ä»–" onchange="toggleOtherInput()"><span>å…¶ä»–</span></label>
                    </div>
                    <!-- æ‰‹å‹•è¼¸å…¥æ¡† -->
                    <div id="washOtherInput" class="other-input">
                        <input type="text" id="washOtherText" placeholder="è«‹è¼¸å…¥ç‰¹æ®Šæ´—æ»Œæ–¹å¼...">
                    </div>
                </div>

                <!-- é£¾å“ä¿é¤Š (è‡ªå‹•å°æ‡‰) -->
                <div id="accCare" class="conditional-block">
                    <label>å»ºè­°ä¿é¤Šæ–¹å¼ (ç³»çµ±å°‡æ ¹æ“šæè³ªè‡ªå‹•è¨­å®š)</label>
                    <div style="padding:15px; background:#F0F0F0; border-radius:8px; font-size:0.9rem; color:#666;">
                        ç³»çµ±æœƒæ ¹æ“šæ‚¨é¸æ“‡çš„æè³ª (å¦‚éŠ€ã€çš®é©ã€çç ) è‡ªå‹•æ¨™è¨˜æœ€ä½³ä¿é¤Šå»ºè­°ã€‚
                    </div>
                </div>

                <label style="margin-top:20px">å¯æ›¿ä»£å“ç¾¤çµ„ (é¸å¡«)</label>
                <input type="text" id="itemAltGroup" placeholder="ä¾‹å¦‚ï¼šbasic_white_tee">

                <div style="display:flex; justify-content:space-between; margin-top:20px;">
                    <button type="button" class="btn btn-secondary" onclick="changeStep(-1)">ä¸Šä¸€æ­¥</button>
                    <button type="button" class="btn btn-primary" onclick="addItem()">åŠ å…¥è¡£æ«¥</button>
                </div>
            </div>
        </form>
    </section>

    <!-- è¡£æ«¥å±•ç¤º -->
    <section class="card">
        <h3 style="margin-bottom:20px;">æˆ‘çš„è¡£æ«¥</h3>
        <div class="closet-grid" id="closetGrid">
            <p style="grid-column:1/-1; text-align:center; color:#AAA;">è¼‰å…¥è¡£æ«¥ä¸­...</p>
        </div>
    </section>

    <!-- æ¨è–¦æ¢ä»¶è¼¸å…¥ -->
    <section class="card">
        <h3>ä»Šæ—¥ç©¿æ­è¨­å®š</h3>
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px;">
            <div>
                <label>ç¾åœ¨æ°£æº« (Â°C)</label>
                <input type="number" id="todayTemp" value="24">
            </div>
            <div>
                <label>ä»Šæ—¥å ´æ™¯</label>
                <select id="todayScene">
                    <option value="Work">ä¸Šç­</option>
                    <option value="School">ä¸Šèª²</option>
                    <option value="Casual">ä¼‘é–’</option>
                    <option value="Date">ç´„æœƒ</option>
                    <option value="NightOut">å¤œé–“å¤–å‡º</option>
                    <option value="Formal">æ­£å¼å ´åˆ</option>
                </select>
            </div>
        </div>

        <div style="margin-top:20px;">
            <label>ä»Šæ—¥å¿ƒæƒ… (å–®é¸)</label>
            <div class="checkbox-group" id="moodContainer">
                <!-- JS æ¸²æŸ“ Mood -->
            </div>
        </div>

        <div style="margin-top:20px; display:flex; gap:30px; flex-wrap:wrap;">
            <label class="toggle-switch">
                <input type="checkbox" id="todayRain">
                <span class="switch-bg"></span> æ˜¯å¦ä¸‹é›¨ï¼Ÿ
            </label>
            <label class="toggle-switch">
                <input type="checkbox" id="needOuter">
                <span class="switch-bg"></span> éœ€è¦å¤–å¥—ï¼Ÿ
            </label>
            <label class="toggle-switch">
                <input type="checkbox" id="needAcc" checked>
                <span class="switch-bg"></span> éœ€è¦é£¾å“ï¼Ÿ
            </label>
        </div>

        <div style="margin-top:20px;">
            <label>æƒ³å˜—è©¦çš„é¢¨æ ¼ (å¯å¤šé¸)</label>
            <div class="checkbox-group" id="styleContainerRec">
                <!-- JS æ¸²æŸ“ Style -->
            </div>
        </div>

        <div style="text-align:center; margin-top:30px;">
            <button class="btn btn-primary" onclick="generateOutfits()">ç”¢ç”Ÿä»Šæ—¥ç©¿æ­</button>
        </div>
    </section>

    <!-- æ¨è–¦çµæœ -->
    <section class="card result-section" id="resultSection">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <button class="btn btn-secondary" onclick="prevOutfit()">â® ä¸Šä¸€å¥—</button>
            <h4 style="margin:0;">ç©¿æ­ææ¡ˆ <span id="outfitIdx">1</span> / 3</h4>
            <button class="btn btn-secondary" onclick="nextOutfit()">ä¸‹ä¸€å¥— â¯</button>
        </div>

        <div class="weather-banner" id="weatherBanner"></div>

        <div class="vibe-tags" id="vibeTags"></div>

        <div class="outfit-display" id="outfitDisplay"></div>

        <div class="philosophy-box" id="philosophyText"></div>

        <div class="extra-info">
            <div class="info-block" id="fragranceBox"></div>
            <div class="info-block" id="motivationBox"></div>
        </div>

        <div class="feedback-btns">
            <button class="fb-btn" onclick="handleFeedback('cold')">â„ï¸ å¤ªå†·</button>
            <button class="fb-btn" onclick="handleFeedback('good')">â¤ï¸ å‰›å¥½</button>
            <button class="fb-btn" onclick="handleFeedback('hot')">ğŸ”¥ å¤ªç†±</button>
            <button class="fb-btn" onclick="handleFeedback('dislike')">ğŸ’” ä¸å–œæ­¡</button>
        </div>
    </section>

</div>

<script>
    /* 
     * ğŸ§© Data Definitions
     */
    
    // æ“´å……é¢¨æ ¼åˆ—è¡¨
    const ALL_STYLES = [
        "æ¥µç°¡", "å„ªé›…", "ç”œç¾", "è¡—é ­", "ä¸­æ€§", "éŸ“ç³»", "æ—¥ç³»", "æ–‡é’", "å…¸é›… / å¾©å¤",
        "æ­£å¼", "é‹å‹•é¢¨", "æ°£è³ª", "å¤§è†½å€‹æ€§", "ä¼‘é–’", "å¯æ„›", "æ°£å ´å¼·", "æ¥µè‡´ç°¡ç´„",
        "æŸ”å’Œæº«æŸ”", "ç¾å¼ä¼‘é–’", "æ ¡åœ’é¢¨", "Y2K", "æ³¢è¥¿ç±³äº", "å·¥è£é¢¨"
    ];

    // æ“´å……å¿ƒæƒ…åˆ—è¡¨
    const ALL_MOODS = [
        "æ”¾é¬†", "é–‹å¿ƒ", "æƒ³è¦æ²ˆç©©", "éœ€è¦å‹‡æ°£", "è‡ªä¿¡", "å„ªé›…", "æ´»æ½‘", "ä¸­æ€§é…·",
        "æº«æŸ”", "ç²¾ç¥å¾ˆå¥½", "æœ‰é»ç´¯ä½†åŠªåŠ›æ’", "æƒ³è¦ç™‚ç™’", "èªçœŸä½†ä¸åš´è‚…", "æƒ³ä½èª¿", "æƒ³çªå‡º"
    ];

    // ä¸­æ–‡åŒ–å°ç…§è¡¨ (éƒ¨åˆ†ä¿ç•™ID, é¡¯ç¤ºç”¨ä¸­æ–‡)
    const labelMap = {
        'top': 'ä¸Šè¡£', 'bottom': 'ä¸‹èº«', 'onepiece': 'é€£èº«', 'outer': 'å¤–å¥—', 'accessory': 'é£¾å“',
        'cold': 'å¯’å†·', 'cool': 'æ¶¼çˆ½', 'warm': 'æ‚¶ç†±',
        
        // Materials
        'Cotton': 'æ£‰', 'Linen': 'éº»', 'Wool': 'ç¾Šæ¯›', 'Silk': 'çµ²', 'Polyester': 'èšé…¯', 'Denim': 'ä¸¹å¯§', 'Leather': 'çš®é©',
        'Knitted': 'é‡ç¹”', 'Cashmere': 'ç¾Šçµ¨', 'Suede': 'çµ¨é¢', 'Shearling': 'ç¾Šç¾”æ¯›', 'Ribbed': 'ç¾…ç´‹å¸ƒ', 'Chiffon': 'é›ªç´¡', 'Spandex': 'å½ˆæ€§çº–ç¶­',
        
        // Acc Materials
        'Gold': 'é‡‘', 'Silver': 'éŠ€', 'Copper': 'éŠ…', 'Platinum': 'é‰‘é‡‘', 'RoseGold': 'ç«ç‘°é‡‘', 'Pearl': 'çç ', 'Gem': 'æ°´æ™¶/å¯¶çŸ³',
        'Beads': 'ç ä¸²', 'Acrylic': 'å£“å…‹åŠ›', 'Wood': 'æœ¨é ­', 'Weave': 'ç·¨ç¹”', 'Fabric': 'å¸ƒæ–™', 'Natural': 'è‡ªç„¶æè³ª',

        // Scenes
        'Work': 'ä¸Šç­', 'Casual': 'ä¼‘é–’', 'Date': 'ç´„æœƒ', 'Sport': 'é‹å‹•', 'Travel': 'æ—…éŠ',
        'School': 'ä¸Šèª²', 'Formal': 'æ­£å¼å ´åˆ', 'Home': 'å®¶å±…', 'NightOut': 'å¤œé–“å¤–å‡º', 'Photoshoot': 'æ‹ç…§',

        // Acc Types
        'Necklace': 'é …éŠ', 'Bracelet': 'æ‰‹éŠ', 'Earrings': 'è€³ç’°', 'Ring': 'æˆ’æŒ‡', 'Hat': 'å¸½å­', 'HairAcc': 'é«®é£¾', 'Watch': 'æ‰‹éŒ¶',
        'Sunglasses': 'å¢¨é¡', 'Belt': 'è…°å¸¶', 'Scarf': 'åœå·¾', 'Gloves': 'æ‰‹å¥—', 'Brooch': 'èƒ¸é‡', 'Anklet': 'è…³éŠ', 'Other': 'å…¶ä»–'
    };

    // 100å¥å¿ƒæƒ…å°èª
    const moodMessages = [
        "ä»Šå¤©çš„ä½ ï¼Œæ¯”é™½å…‰æ›´æº«æš–ã€‚", "ç©¿ä¸Šé€™å¥—è¡£æœï¼Œä¸–ç•Œéƒ½æœƒå°ä½ æº«æŸ”ä¸€é»ã€‚", "ä½ æœ¬ä¾†å°±å¾ˆå¥½ï¼Œåªæ˜¯è¡£æœæé†’äº†ä½ é€™ä»¶äº‹ã€‚", "ä»Šå¤©ä¹Ÿè¦ç”¨å–œæ­¡è‡ªå·±çš„æ–¹å¼ç”Ÿæ´»ã€‚", "ç©¿æ­åªæ˜¯å¤–åœ¨ï¼Œå…‰èŠ’ä¸€ç›´éƒ½åœ¨ä½ å¿ƒè£¡ã€‚",
        "æº«æŸ”ä¸æ˜¯ç´¯è´…ï¼Œè€Œæ˜¯ä½ çš„åŠ›é‡ã€‚", "å¸Œæœ›ä»Šå¤©çš„é¢¨ï¼Œéƒ½é †è‘—ä½ çš„æ–¹å‘å¹ã€‚", "ç©¿ä¸Šå–œæ­¡çš„è¡£æœï¼Œä¹ŸåŒæ™‚ç©¿ä¸Šå‹‡æ°£ã€‚", "ä¸å¿…å®Œç¾ï¼Œåªè¦è‡ªåœ¨å°±å¾ˆå¥½ã€‚", "ä»Šå¤©çš„ä½ ï¼Œå€¼å¾—è¢«å¥½å¥½æ¬£è³ã€‚",
        "ä¸–ç•Œæˆ–è¨±å¿™äº‚ï¼Œä½†ä½ çš„æ­¥ä¼å¯ä»¥å¾ˆå¹³éœã€‚", "ä½ çš„å­˜åœ¨ï¼Œå°±å·²ç¶“æ˜¯ä¸€ç¨®é¢¨æ™¯ã€‚", "æ›ä¸Šèˆ’é©çš„è¡£æœï¼ŒæŠŠç…©æƒ±ä¹Ÿæ›æ‰ã€‚", "è¡£æœæ˜¯é™ªä¼´ï¼Œè€Œä½ æ‰æ˜¯ä¸»è§’ã€‚", "ç¾å¾ä¾†ä¸æ˜¯å¼µæšï¼Œè€Œæ˜¯å‰›å‰›å¥½è¢«çœ‹åˆ°ã€‚",
        "å¸Œæœ›ä½ çš„å¿ƒï¼Œå¦‚å¸ƒæ–™èˆ¬æŸ”è»Ÿã€‚", "ä»Šå¤©ä¹Ÿè¦è¨˜å¾—æ„›è‡ªå·±å¤šä¸€é»ã€‚", "ç”Ÿæ´»å¾ˆåµï¼Œä½†ä½ çš„å¿ƒå¯ä»¥å¾ˆå®‰éœã€‚", "ç„¡è«–å»å“ªè£¡ï¼Œéƒ½é¡˜æº«æš–è·Ÿè‘—ä½ ã€‚", "å–œæ­¡çš„ç©¿æ­ï¼Œæ˜¯éˆé­‚çš„èªè¨€ã€‚",
        "ä¸ç”¨åŠªåŠ›åšèª°ï¼Œä½ æœ¬ä¾†å°±å¾ˆå¥½ã€‚", "ä»Šå¤©çš„é¸æ“‡ï¼Œæœƒè®“ä½ æ›´æ¥è¿‘æƒ³è¦çš„è‡ªå·±ã€‚", "æ‹¿å‡ºä½ æœ€èˆ’æœçš„é‚£ä»¶è¡£æœâ€”å®ƒæ‡‚ä½ ã€‚", "ç©¿æ­ä¸æ˜¯è¦å‰‡ï¼Œæ˜¯è‡ªç”±ã€‚", "é¡˜ä½ ä»Šå¤©çš„å¿ƒæƒ…å¦‚é¡è‰²èˆ¬ä¹¾æ·¨æ˜äº®ã€‚",
        "èˆ’é©èˆ‡ç¾ï¼Œå…¶å¯¦å¯ä»¥ä¸€èµ·ã€‚", "ä½ çš„å­˜åœ¨è®“ä»Šå¤©è®Šå¾—æ›´æŸ”è»Ÿã€‚", "å¸Œæœ›ä½ ä»Šå¤©èƒ½è¢«å–„æ„åŒ…åœã€‚", "é¸è¡£æœä¹Ÿæ˜¯é¸å¿ƒæƒ…ã€‚", "ä¸ç¢ºå®šçš„æ™‚å€™ï¼Œå°±é¸è®“ä½ å¹³éœçš„é‚£ä»¶ã€‚",
        "æº«æŸ”ä¸æ˜¯å¼±ï¼Œæ˜¯åŠ›é‡çš„å¦ä¸€ç¨®æ¨£å­ã€‚", "ä½ å€¼å¾—æ¯ä¸€ä»½ç´°ç·»çš„å°å¾…ã€‚", "æ„‰å¿«çš„ç©¿æ­ï¼Œæœƒè®“ä¸€å¤©è®Šè¼•ç›ˆã€‚", "ä½ ä¸éœ€è¦å¾ˆäº®ï¼Œä¹Ÿèƒ½æˆç‚ºç„¦é»ã€‚", "ä»Šå¤©çš„é¢¨æ™¯ï¼Œå› ç‚ºä½ è€Œå®Œæ•´ã€‚",
        "é¡˜æ¯ä¸€æ­¥éƒ½æœ‰è‡ªä¿¡é™ªè‘—ä½ ã€‚", "ç©¿è‘—èˆ’æœï¼Œæ˜¯å°è‡ªå·±æœ€å¤§çš„å–„æ„ã€‚", "åˆ¥å¿˜äº†æŠ¬é ­çœ‹çœ‹å¤©ç©ºï¼Œè·Ÿä½ ä¸€æ¨£æº«æŸ”ã€‚", "ç„¡è«–é¸å“ªå¥—ï¼Œéƒ½æœƒè®“ä½ å¾ˆå¥½çœ‹ã€‚", "ä»Šå¤©çš„ä½ ï¼Œæ˜¯è‡ªå·±çš„å¹¸é‹æ˜Ÿã€‚",
        "å¸Œæœ›ä½ ä»Šå¤©é‡åˆ°çš„éƒ½æ˜¯æŸ”è»Ÿçš„äº‹ã€‚", "ä½ çš„ç¾å¥½ï¼Œé æ¯”ä½ ä»¥ç‚ºçš„æ›´å¤šã€‚", "æ¯ä¸€å¤©éƒ½å€¼å¾—è¢«å¥½å¥½æ‰“æ‰®ã€‚", "è¡£æœä¸æœƒæ”¹è®Šä½ ï¼Œä½†èƒ½å½±éŸ¿å¿ƒæƒ…ã€‚", "ç©©å®šï¼Œæ˜¯æœ€æº«æŸ”çš„åŠ›é‡ã€‚",
        "æ„Ÿå—å¸ƒæ–™è²¼è‘—çš®è†šçš„é‚£ç¨®å®‰å¿ƒã€‚", "å¸Œæœ›ä½ ä»Šå¤©ç¬‘å¾—åƒæ–°æ´—å¥½çš„è¡£æœä¸€æ¨£ä¹¾æ·¨ã€‚", "é¢¨æœƒæ›¿ä½ å¸¶èµ°ä¸å¿«ã€‚", "ä½ çš„å­˜åœ¨ï¼Œå°±æ˜¯æº«åº¦ã€‚", "æ²’æœ‰èª°è¦å®šä½ ä¸èƒ½ç™¼å…‰ã€‚",
        "æ¯ä¸€æ¬¡é¸æ“‡ï¼Œéƒ½è®“ä½ æ›´åƒä½ è‡ªå·±ã€‚", "ä»Šå¤©ä¹Ÿè¦ç©¿å¾—åƒè‡ªå·±çš„å¿ƒæƒ…ã€‚", "ä½ çš„æ­¥ä¼ï¼Œæ¯”ä»€éº¼éƒ½é‡è¦ã€‚", "ç¾ä¸æ˜¯æ¯”è¼ƒï¼Œæ˜¯æ„Ÿè¦ºã€‚", "ä½ å€¼å¾—ä»»ä½•ç´°ç·»çš„äº‹ç‰©é è¿‘ã€‚",
        "è¡£æœèƒ½çµ¦ä½ å½¢ç‹€ï¼Œä½†æ…‹åº¦çµ¦ä½ åŠ›é‡ã€‚", "é¡˜ä»Šå¤©çš„ä½ ï¼Œè¢«è‡ªå·±å–œæ­¡ã€‚", "æœ€èˆ’æœçš„æ¨£å­ï¼Œå°±æ˜¯æœ€ç¾çš„æ¨£å­ã€‚", "ä»Šå¤©çš„ä½ æ˜¯æº«æŸ”çš„è­‰æ“šã€‚", "ä¸€ä»¶è¡£æœå°±èƒ½è®“å¿ƒé‡æ–°è¢«ç…§äº®ã€‚",
        "é¡˜ä½ æ¯å¤©éƒ½èˆ‡å¹³éœåŒè¡Œã€‚", "å–œæ­¡ç©¿ä»€éº¼ï¼Œå°±æ˜¯å–œæ­¡ç”Ÿæ´»ä»€éº¼ã€‚", "æ°£è³ªä¸æ˜¯ç©¿å‡ºä¾†ï¼Œæ˜¯æ´»å‡ºä¾†ã€‚", "ä½ çš„è¼•ç›ˆï¼Œä¸–ç•Œæœƒçœ‹è¦‹ã€‚", "åˆ¥æ€¥ï¼Œæ…¢æ…¢ä¾†ä¹Ÿå¾ˆå¥½ã€‚",
        "ä½ å€¼å¾—è¢«ä¸–ç•Œæº«æŸ”ä»¥å¾…ã€‚", "å¿ƒè‹¥æŸ”è»Ÿï¼Œè™•è™•çš†é¢¨æ™¯ã€‚", "ç„¡è«–ä»€éº¼å¿ƒæƒ…ï¼Œä½ éƒ½å¯ä»¥å¾ˆç¾ã€‚", "ä¸–ç•Œå¾ˆåµï¼Œä½†ä½ å¯ä»¥å¾ˆå®‰ç©©ã€‚", "è¼•è¼•ç©¿ä¸Šè¡£æœï¼Œä¹Ÿè¼•è¼•æ¥ä½è‡ªå·±ã€‚",
        "ä½ çš„å­˜åœ¨è®“ä»Šå¤©è®Šå¾—æŸ”å’Œã€‚", "æ¯ä¸€ä»¶è¡£æœéƒ½æœ‰å®ƒçš„æ•…äº‹ï¼Œä½ ä¹Ÿæœ‰ã€‚", "ç©¿æ­æ˜¯ä¸€ç¨®èªè¨€ï¼Œä½ æ­£èªªè‘—æº«æŸ”ã€‚", "ä¸å¿…ç‚ºèª°ç››è£ï¼Œä½ å°±æ˜¯ç†ç”±ã€‚", "ä¸–ç•Œæœƒå› ä½ çš„åå­—è€Œäº®ä¸€é»ã€‚",
        "å¸Œæœ›ä»Šå¤©æ‰€æœ‰çš„è·¯éƒ½å‰›å‰›å¥½ã€‚", "ç¾æ˜¯ä¸€ç¨®æº«åº¦ï¼Œè€Œä½ è‡ªå¸¶æš–æ„ã€‚", "ç©¿ä¸Šå–œæ­¡çš„è¡£æœï¼Œæ˜¯ä¸€ç¨®å°å°å¹¸ç¦ã€‚", "ä½ çš„çœ¼ç¥æ¯”é£¾å“æ›´é–ƒè€€ã€‚", "ä»Šå¤©çš„ä½ ï¼Œæ˜¯è‡ªå·±çš„æµªæ¼«ã€‚",
        "é¡˜ä½ è¢«å–„æ„ç’°æŠ±ï¼Œä¹Ÿé¡˜ä½ çµ¦è‡ªå·±æº«æŸ”ã€‚", "ç©¿æ­æ˜¯ç”Ÿæ´»çš„æº«æŸ”æé†’ã€‚", "ç¾ä¸æ˜¯ç›®çš„ï¼Œæ˜¯éç¨‹ã€‚", "ä»Šå¤©çš„ä½ å€¼å¾—è¢«å¥½å¥½å°å¾…ã€‚", "å¸Œæœ›ä½ ä»Šå¤©ç¢°åˆ°çš„éƒ½æ˜¯å¥½äº‹ã€‚",
        "ç©¿ä¸Šé€™ä»¶ï¼Œé€£é¢¨éƒ½æœƒç‚ºä½ åœç•™ã€‚", "ä½ ä¸å¿…åŠªåŠ›æˆç‚ºèª°ï¼Œä½ å°±æ˜¯ç­”æ¡ˆã€‚", "ä½ çš„å¿ƒæƒ…å€¼å¾—è¢«å¥½å¥½å®‰æ”¾ã€‚", "é¡˜ä½ ä»Šå¤©çš„æ­¥ä¼ä¸æ…Œä¸å¿™ã€‚", "è¡£æœæ˜¯é™ªä½ èµ°è·¯çš„é¢¨æ™¯ã€‚",
        "ä½ æ¯”æƒ³åƒçš„æ›´æº«æŸ”ï¼Œä¹Ÿæ›´å …å¼·ã€‚", "ä»Šå¤©çš„é™½å…‰æ­£å¥½ï¼Œé©åˆå–œæ­¡è‡ªå·±ã€‚", "é¡˜ä½ çš„æ¯ä¸€æ­¥éƒ½å¸¶è‘—è‡ªç”±ã€‚", "ç„¡è«–ç™¼ç”Ÿä»€éº¼ï¼Œä½ éƒ½è¶³å¤ ã€‚", "åˆ¥å¿˜äº†ï¼Œä½ ä¸€ç›´éƒ½æœ‰å…‰ã€‚",
        "ç©¿æ­ä¸èƒ½è§£æ±ºæ‰€æœ‰äº‹ï¼Œä½†èƒ½æ²»å¥½ä¸€éƒ¨åˆ†ã€‚", "é¡˜ä½ è¢«ç”Ÿæ´»æº«æŸ”æ”¶è—ã€‚", "ä»Šå¤©çš„ä½ ï¼Œæ˜¯å°å®‡å®™æœ€æ˜äº®çš„æ˜Ÿã€‚", "è¡£æœæ˜¯å¤–åœ¨ï¼Œå¿ƒæ˜¯æ°¸æ†çš„é¢¨æ™¯ã€‚", "ä»Šå¤©çš„ä½ ï¼Œå‰›å‰›å¥½ï¼Œç¾å¾—å‰›å‰›å¥½ã€‚"
    ];

    /* 
     * ğŸ§© UI Rendering Helpers
     */
    function renderStyleTags(containerId, nameAttr) {
        const container = document.getElementById(containerId);
        container.innerHTML = ALL_STYLES.map(style => `
            <label class="check-tag">
                <input type="checkbox" name="${nameAttr}" value="${style}">
                <span>${style}</span>
            </label>
        `).join('');
    }

    function renderMoodTags(containerId, nameAttr) {
        const container = document.getElementById(containerId);
        // Mood is Radio (single choice) conceptually, but UI looks like tags. 
        // Using radio behavior for logic, but styled same as check-tag.
        container.innerHTML = ALL_MOODS.map(mood => `
            <label class="check-tag">
                <input type="radio" name="${nameAttr}" value="${mood}">
                <span>${mood}</span>
            </label>
        `).join('');
    }

    // Init UI
    renderStyleTags('styleContainerAdd', 'itemStyle');
    renderStyleTags('styleContainerRec', 'todayStyle');
    renderMoodTags('moodContainer', 'todayMood');


    /* 
     * ğŸ§© Form Logic
     */
    let closet = [
        // Demo Data
        { id: 1, name: "ç¾Šæ¯›é‡ç¹”è¡«", type: "top", weather: "cold", thickness: "medium", material: ["Wool", "Knitted"], style: ["æ¥µç°¡", "å…¸é›… / å¾©å¤"], scene: ["Work", "Date", "School"], color: "Brown", wash: "ä¹¾æ´—", img: "https://images.unsplash.com/photo-1576566588028-4147f3842f27?w=400", usageCount: 5, altGroup: "sweater_basic" },
        { id: 2, name: "ç™½è‰²é›ªç´¡è¥¯è¡«", type: "top", weather: "warm", thickness: "thin", material: ["Chiffon"], style: ["ç”œç¾", "æ°£è³ª"], scene: ["Casual", "Date"], color: "White", wash: "æ‰‹æ´—", img: "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=400", usageCount: 2, altGroup: "white_shirt" },
        { id: 3, name: "çç è€³ç’°", type: "accessory", accType: "Earrings", bodyPart: "Ears", material: ["Pearl", "Gold"], style: ["ç”œç¾", "å„ªé›…"], scene: ["Date", "Formal"], accCare: "è»Ÿå¸ƒæ“¦ã€é¿å…é…’ç²¾", img: "https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?w=400", usageCount: 1, altGroup: "earring" },
        { id: 4, name: "æ¥µç°¡éŠ€æˆ’", type: "accessory", accType: "Ring", bodyPart: "Finger", material: ["Silver"], style: ["æ¥µç°¡", "ä¸­æ€§"], scene: ["Casual", "Work"], accCare: "å¸ƒæ“¦æ‹­ã€éŠ€å¸ƒæ‹‹å…‰", img: "https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400", usageCount: 3, altGroup: "ring" },
        { id: 5, name: "ç›´ç­’ä¸¹å¯§è¤²", type: "bottom", weather: "cool", thickness: "medium", material: ["Denim"], style: ["è¡—é ­", "ä¼‘é–’", "ç¾å¼ä¼‘é–’"], scene: ["Casual", "School"], color: "Blue", wash: "æ©Ÿæ´—", img: "https://images.unsplash.com/photo-1542272454374-d41e9529cf5d?w=400", usageCount: 12, altGroup: "jeans" }
    ];

    let userPreference = { tempBias: 0, styleBias: {}, dislikeItems: [] };
    let generatedOutfits = [];
    let currentOutfitIdx = 0;
    let currentStep = 1;

    function changeStep(dir) {
        if(currentStep === 1 && dir === 1 && !document.getElementById('itemName').value) {
            alert("è«‹è¼¸å…¥å–®å“åç¨±"); return;
        }
        document.getElementById(`step${currentStep}`).classList.remove('active');
        document.getElementById(`dot${currentStep}`).classList.remove('active');
        currentStep += dir;
        document.getElementById(`step${currentStep}`).classList.add('active');
        document.getElementById(`dot${currentStep}`).classList.add('active');
    }

    function toggleFormLogic() {
        const type = document.getElementById('itemType').value;
        const isAcc = type === 'accessory';

        document.getElementById('accSubCategory').style.display = isAcc ? 'block' : 'none';
        
        // Toggle blocks
        document.getElementById('clothesProps').className = isAcc ? 'conditional-block' : 'conditional-block active';
        document.getElementById('accProps').className = isAcc ? 'conditional-block active' : 'conditional-block';
        
        document.getElementById('clothesMaterials').className = isAcc ? 'conditional-block' : 'conditional-block active';
        document.getElementById('accMaterials').className = isAcc ? 'conditional-block active' : 'conditional-block';

        document.getElementById('clothesCare').className = isAcc ? 'conditional-block' : 'conditional-block active';
        document.getElementById('accCare').className = isAcc ? 'conditional-block active' : 'conditional-block';
    }

    function toggleOtherInput() {
        const otherCheckbox = document.querySelector('input[name="washMethod"][value="å…¶ä»–"]');
        const inputDiv = document.getElementById('washOtherInput');
        if (otherCheckbox.checked) inputDiv.classList.add('active');
        else inputDiv.classList.remove('active');
    }

    function getAccCareAdvice(materials) {
        if (materials.includes('Silver')) return "å¸ƒæ“¦æ‹­ã€éŠ€å¸ƒæ‹‹å…‰ã€é¿å…ç¢°æ°´";
        if (materials.includes('Gold') || materials.includes('RoseGold') || materials.includes('Platinum')) return "ä¹¾å¸ƒæ“¦ã€é¿å…é¦™æ°´èˆ‡æ±—æ°´";
        if (materials.includes('Leather')) return "çš®é©æ²¹ã€é™°ä¹¾";
        if (materials.includes('Pearl')) return "è»Ÿå¸ƒæ“¦ã€é¿å…é…’ç²¾";
        if (materials.includes('Gem') || materials.includes('Crystal')) return "ä¹¾å¸ƒæ“¦ã€é¿å…ç¢°æ’";
        if (materials.includes('Wood')) return "ä¿æŒä¹¾ç‡¥ã€é¿å…æ›æ›¬";
        return "ä¹¾å¸ƒè¼•æ“¦ã€æ”¶ç´æ–¼ä¹¾ç‡¥è™•";
    }

    function addItem() {
        const type = document.getElementById('itemType').value;
        const isAcc = type === 'accessory';
        const imgInput = document.getElementById('itemImg');
        const imgUrl = imgInput.files[0] ? URL.createObjectURL(imgInput.files[0]) : "https://via.placeholder.com/400x500/eee/aaa?text=No+Image";
        const getChecked = (name) => Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(el => el.value);

        let newItem = {
            id: Date.now(),
            name: document.getElementById('itemName').value,
            type: type,
            style: getChecked('itemStyle'),
            scene: getChecked('itemScene'),
            color: document.getElementById('itemColor').value,
            altGroup: document.getElementById('itemAltGroup').value,
            img: imgUrl,
            usageCount: 0
        };

        if (isAcc) {
            newItem.accType = document.getElementById('accTypeSelect').value;
            newItem.bodyPart = document.getElementById('accBodyPart').value;
            newItem.material = getChecked('accMat');
            newItem.accCare = getAccCareAdvice(newItem.material);
        } else {
            newItem.weather = document.getElementById('itemWeather').value;
            newItem.thickness = document.getElementById('itemThickness').value;
            newItem.material = getChecked('clothMat');
            
            // çµ„åˆæ´—æ»Œæ–¹å¼
            let washes = getChecked('washMethod');
            if (washes.includes('å…¶ä»–')) {
                const otherText = document.getElementById('washOtherText').value;
                if(otherText) washes.push(otherText);
                washes = washes.filter(w => w !== 'å…¶ä»–');
            }
            newItem.wash = washes.join("ã€");
        }

        closet.push(newItem);
        renderCloset();
        alert("æˆåŠŸåŠ å…¥è¡£æ«¥ï¼");
        document.getElementById('addItemForm').reset();
        
        // Reset Steps & Checkboxes
        currentStep = 4; changeStep(-3);
        toggleFormLogic(); 
        document.getElementById('washOtherInput').classList.remove('active');
    }

    function renderCloset() {
        const grid = document.getElementById('closetGrid');
        grid.innerHTML = closet.map(item => `
            <div class="item-card">
                <div class="usage-badge">å·²ç©¿ ${item.usageCount} æ¬¡</div>
                <img src="${item.img}" alt="${item.name}">
                <div class="item-info">
                    <h4>${item.name}</h4>
                    <div class="item-tags">
                        <span class="tag-pill">${labelMap[item.type] || item.type}</span>
                        ${item.type === 'accessory' ? 
                            `<span class="tag-pill">${labelMap[item.accType] || item.accType}</span>` : 
                            `<span class="tag-pill">${labelMap[item.weather]}</span>`
                        }
                    </div>
                </div>
            </div>
        `).join('');
    }

    /* 
     * ğŸ§© Logic: Recommendation
     */
    function getTempTag(t) {
        let temp = parseFloat(t) + userPreference.tempBias;
        if (temp < 15) return 'cold';
        if (temp < 22) return 'cool';
        return 'warm';
    }

    function getFragrance(styleArray) {
        // æ–°å¢é¢¨æ ¼å°æ‡‰
        if (styleArray.includes('æ¥µç°¡') || styleArray.includes('æ¥µè‡´ç°¡ç´„')) return "æ¸…æ–°æœ¨è³ªèª¿";
        if (styleArray.includes('ç”œç¾') || styleArray.includes('å¯æ„›')) return "èŠ±æœé¦™";
        if (styleArray.includes('æ°£å ´å¼·') || styleArray.includes('å¤§è†½å€‹æ€§') || styleArray.includes('è¡—é ­')) return "ä¸­æ€§è¾›é¦™ / çš®é©èª¿";
        if (styleArray.includes('ä¼‘é–’') || styleArray.includes('ç¾å¼ä¼‘é–’')) return "æŸ‘æ©˜æ¸…æ–°";
        if (styleArray.includes('æ­£å¼') || styleArray.includes('å„ªé›…')) return "æœ¨è³ªï¼‹èŠ±é¦™";
        if (styleArray.includes('ç´„æœƒ') || styleArray.includes('å…¸é›… / å¾©å¤') || styleArray.includes('æ°£è³ª')) return "æ±æ–¹èŠ±é¦™ã€é¦™è‰éºé¦™";
        if (styleArray.includes('é‹å‹•é¢¨') || styleArray.includes('æ ¡åœ’é¢¨')) return "ä¹¾æ·¨è‚¥çš‚æ„Ÿã€è‰æœ¬é¦™";
        if (styleArray.includes('æ—¥ç³»') || styleArray.includes('æ–‡é’')) return "æ¸…æ–°æ£®æ—èª¿ / èŒ¶é¦™";
        if (styleArray.includes('éŸ“ç³»') || styleArray.includes('æŸ”å’Œæº«æŸ”')) return "çš‚æ„Ÿé¦™ / ç´”æ·¨äºéº»";
        if (styleArray.includes('Y2K')) return "ç³–æœç”œé¦™ / é‡‘å±¬å†·èª¿";
        if (styleArray.includes('æ³¢è¥¿ç±³äº')) return "å»£è—¿é¦™ / æª€é¦™";
        if (styleArray.includes('å·¥è£é¢¨') || styleArray.includes('ä¸­æ€§')) return "ç…™ç‡»æœ¨è³ª / è‹”è˜šèª¿";
        
        return "ç´”æ·¨äºéº»é¦™"; 
    }

    function generateOutfits() {
        const temp = document.getElementById('todayTemp').value;
        const scene = document.getElementById('todayScene').value;
        const rain = document.getElementById('todayRain').checked;
        const needOuter = document.getElementById('needOuter').checked;
        const needAcc = document.getElementById('needAcc').checked;
        const selectedStyles = Array.from(document.querySelectorAll('input[name="todayStyle"]:checked')).map(el => el.value);
        
        // å–å¾—å–®é¸å¿ƒæƒ…
        const moodRadio = document.querySelector('input[name="todayMood"]:checked');
        const mood = moodRadio ? moodRadio.value : "å¹³éœ";

        const tempTag = getTempTag(temp);
        
        // Weather Banner
        let weatherText = temp > 22 ? "é™½å…‰å¼·çƒˆï¼Œé©åˆé€æ°£æè³ªã€‚" : (temp < 15 ? "æ°£æº«è¼ƒä½ï¼Œå»ºè­°å¤šå±¤æ¬¡ç©¿æ­ã€‚" : "èˆ’é©å®œäººï¼Œé©åˆå±•ç¾é¢¨æ ¼ã€‚");
        if(rain) weatherText = "æ¿•åº¦åé«˜ï¼Œå»ºè­°é¸æ“‡ä¸æ˜“å¸æ°´æè³ªã€‚";
        document.getElementById('weatherBanner').innerHTML = `
            <div class="weather-icon">${rain ? 'ğŸŒ§' : (temp>22?'ğŸ”¥':'â˜€')}</div>
            <div class="weather-text"><h3>${temp}Â°C / ${labelMap[tempTag]}</h3><p>${weatherText}</p></div>
        `;

        generatedOutfits = [];

        // Score Item Function
        const scoreItem = (item) => {
            if(userPreference.dislikeItems.includes(item.id)) return -100;
            let score = 0;
            
            // Match Style
            if (item.style.some(s => selectedStyles.includes(s))) score += 10;
            
            // Match Scene
            if (item.scene.includes(scene)) score += 5;

            // Clothes specific: Weather
            if (item.type !== 'accessory') {
                if (item.weather === tempTag) score += 10;
                if (tempTag === 'cool' && item.weather === 'cold') score += 5;
            }

            // Acc specific
            if (item.type === 'accessory') score += Math.random() * 5;

            return score + Math.random() * 5;
        };

        const getBestItem = (type) => {
            const candidates = closet.filter(i => i.type === type).sort((a,b) => scoreItem(b) - scoreItem(a));
            return candidates.slice(0, 3)[Math.floor(Math.random() * Math.min(candidates.length, 3))];
        };

        for(let i=0; i<3; i++) {
            let outfit = {};
            outfit.top = getBestItem('top');
            outfit.bottom = getBestItem('bottom') || getBestItem('pants');
            outfit.outer = needOuter ? getBestItem('outer') : null;
            outfit.acc = needAcc ? getBestItem('accessory') : null;
            outfit.meta = { temp, scene, rain, mood };
            
            if(outfit.top && (outfit.bottom || outfit.onepiece)) generatedOutfits.push(outfit);
        }

        if(generatedOutfits.length === 0) {
            alert("è¡£ç‰©æ•¸é‡ä¸è¶³ä»¥ç”¢ç”Ÿæ¨è–¦ï¼Œè«‹å…ˆæ–°å¢æ›´å¤šå–®å“ã€‚"); return;
        }

        currentOutfitIdx = 0;
        document.getElementById('resultSection').style.display = 'block';
        renderOutfit(0);
        document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
    }

    function renderOutfit(idx) {
        const outfit = generatedOutfits[idx];
        document.getElementById('outfitIdx').textContent = idx + 1;

        const items = [outfit.top, outfit.bottom, outfit.outer, outfit.acc].filter(x => x);
        const display = document.getElementById('outfitDisplay');
        
        display.innerHTML = items.map(item => {
            let desc = "";
            if (item.type === 'accessory') desc = `${labelMap[item.accType]} Â· ${item.accCare}`;
            else desc = `${labelMap[item.material[0]] || ""} Â· ${item.wash}`;

            return `
            <div class="outfit-piece" style="animation: fadeIn 0.5s ease">
                <img src="${item.img}">
                <strong>${item.name}</strong><br>
                <span style="font-size:0.8rem; color:#888;">${desc}</span>
            </div>`;
        }).join('');

        // Vibe Tags
        const allStyles = items.flatMap(i => i.style);
        const mainStyle = allStyles[0] || 'æ¥µç°¡';
        const uniqueStyles = [...new Set(allStyles)].slice(0, 3).join(' Ã— ');
        document.getElementById('vibeTags').textContent = `âœ¨ ä»Šæ—¥æ°›åœï¼š${uniqueStyles}`;

        // Fragrance
        const scent = getFragrance(allStyles);
        document.getElementById('fragranceBox').innerHTML = `
            <strong>ğŸŒ¿ é¦™å‘³æ°›åœå»ºè­°</strong><br>
            <span style="color:var(--accent); font-weight:500;">${scent}</span><br>
            <span style="font-size:0.8rem; color:#999;">(å°æ‡‰ ${mainStyle} é¢¨æ ¼)</span>
        `;

        // Mood Message
        const msg = moodMessages[Math.floor(Math.random() * moodMessages.length)];
        document.getElementById('motivationBox').innerHTML = `<strong>âœ¨ çµ¦ä½ çš„ä¸€å¥è©±</strong><br>${msg}`;

        // Philosophy
        const philosophies = [
            `é€™å¥—æ­é…ä»¥${outfit.top.name}ç‚ºä¸»èª¿ï¼Œå‘¼æ‡‰ä»Šå¤©çš„${labelMap[outfit.meta.scene]}éœ€æ±‚ã€‚`,
            `é¸æ“‡${mainStyle}é¢¨æ ¼ï¼Œå¸Œæœ›èƒ½è®“ä½ æ„Ÿåˆ°${outfit.meta.mood}ã€‚`,
            `è€ƒé‡åˆ°${outfit.meta.temp}Â°Cçš„å¤©æ°£ï¼Œæè³ªçš„é¸æ“‡æ˜¯é‡é»ã€‚`
        ];
        
        document.getElementById('philosophyText').innerHTML = philosophies.join("<br>");
    }

    // Navigation & Feedback
    function prevOutfit() { if(currentOutfitIdx > 0) { currentOutfitIdx--; renderOutfit(currentOutfitIdx); } }
    function nextOutfit() { if(currentOutfitIdx < generatedOutfits.length - 1) { currentOutfitIdx++; renderOutfit(currentOutfitIdx); } }
    function handleFeedback(type) { 
        if(type==='dislike') alert("å·²åŠ å…¥ä¸å–œæ­¡æ¸…å–®");
        else alert("è¬è¬å›é¥‹ï¼Œç³»çµ±å°‡æŒçºŒå­¸ç¿’æ‚¨çš„åå¥½ã€‚");
    }

    // Init
    renderCloset();
    toggleFormLogic();
</script>

</body>
</html>